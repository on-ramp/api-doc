
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ON/RAMP payment API v1.4.15</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="../stylesheets/screen-697acf91.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="../javascripts/all-a9fde460.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="server-to-server server-to-server_index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="../images/logo-86952380.png" class="logo" alt="" />
        <span class="toc-link">API v1.4.15</span>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#on-ramp-merchant-integration" class="toc-h1 toc-link" data-title="ON/RAMP merchant integration.">ON/RAMP merchant integration.</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#terminology-and-acronyms" class="toc-h2 toc-link" data-title="Terminology and Acronyms">Terminology and Acronyms</a>
                  </li>
                  <li>
                    <a href="#base-url" class="toc-h2 toc-link" data-title="Base URL">Base URL</a>
                  </li>
                  <li>
                    <a href="#changelog" class="toc-h2 toc-link" data-title="Changelog">Changelog</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#calling-on-ramp-api-endpoints" class="toc-h1 toc-link" data-title="Calling ON/RAMP API endpoints">Calling <strong>ON/RAMP</strong> API endpoints</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#error-handling" class="toc-h2 toc-link" data-title="Error handling">Error handling</a>
                  </li>
                  <li>
                    <a href="#webhook-callbacks" class="toc-h2 toc-link" data-title="Webhook callbacks">Webhook callbacks</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#server-to-server-s2s" class="toc-h1 toc-link" data-title="Server to Server (S2S)">Server to Server (S2S)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#flow" class="toc-h2 toc-link" data-title="Flow">Flow</a>
                  </li>
                  <li>
                    <a href="#authentication" class="toc-h2 toc-link" data-title="Authentication">Authentication</a>
                  </li>
                  <li>
                    <a href="#creating-an-operation" class="toc-h2 toc-link" data-title="Creating an operation">Creating an operation</a>
                  </li>
                  <li>
                    <a href="#callbacks" class="toc-h2 toc-link" data-title="Callbacks">Callbacks</a>
                  </li>
                  <li>
                    <a href="#retrieving-operation-statuses" class="toc-h2 toc-link" data-title="Retrieving operation statuses">Retrieving operation statuses</a>
                  </li>
                  <li>
                    <a href="#updating-an-operation" class="toc-h2 toc-link" data-title="Updating an operation">Updating an operation</a>
                  </li>
                  <li>
                    <a href="#testing" class="toc-h2 toc-link" data-title="Testing">Testing</a>
                  </li>
                  <li>
                    <a href="#bank-payments-flow" class="toc-h2 toc-link" data-title="Bank payments flow">Bank payments flow</a>
                  </li>
                  <li>
                    <a href="#api-changes-amp-backwards-compatibility" class="toc-h2 toc-link" data-title="API changes &amp; backwards compatibility:">API changes &amp; backwards compatibility:</a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='on-ramp-merchant-integration'>ON/RAMP merchant integration.</h1><h2 id='terminology-and-acronyms'>Terminology and Acronyms</h2>
<ul>
<li>Merchant: The service using <strong>ON/RAMP</strong> as payment processor.</li>
<li>User: The physical person who sends or receives funds to/from the merchant through <strong>ON/RAMP</strong>.</li>
<li>CC: credit card.</li>
</ul>
<h2 id='base-url'>Base URL</h2>
<p>Production:
<strong><a href="https://api.onramp.ltd">https://api.onramp.ltd/s2s</a></strong></p>

<p>Test:
<strong><a href="https://stage-api.onramp.ltd">https://stage-api.onramp.ltd/s2s</a></strong></p>
<h2 id='changelog'>Changelog</h2>
<p>Changes since v1.4.15:</p>

<ul>
<li>Added new Egress Crypto Flow</li>
</ul>

<p>Changes since v1.4.14:</p>

<ul>
<li>Added new Crypto Ingress Flow and Iframe to work with account based blockchains</li>
</ul>

<p>Changes since v1.4.13:</p>

<ul>
<li>Added <code>first_time</code> parameter on ingress flow</li>
</ul>

<p>Changes since v1.4.12:</p>

<ul>
<li>Added <code>x_api_key</code> parameter on the crypto ingress iframe flow</li>
</ul>

<p>Changes since v1.4.11:</p>

<ul>
<li>Specified parameters required for new bank payment</li>
</ul>

<p>Changes since v1.4.10:</p>

<ul>
<li>Added <code>card_type</code> to ingress flow parameters</li>
<li>Added <code>order_id</code> to ingress flow parameters</li>
</ul>

<p>Changes since v1.4.9:</p>

<ul>
<li>Made street and city fields required</li>
</ul>

<p>Changes since v1.4.8:</p>

<ul>
<li>Updated confirmation callback</li>
</ul>

<p>Changes since v1.4.7:</p>

<ul>
<li>Docummented the addition of <code>op_id</code> for <code>create_operation</code> endpoint</li>
</ul>

<p>Changes since v1.4.6:</p>

<ul>
<li>Updated some fields for 3DS</li>
</ul>

<p>Changes since v1.4.5:</p>

<ul>
<li>Updated some fields for 3DS</li>
</ul>

<p>Changes since v1.4.4:</p>

<ul>
<li>Updated 3ds values</li>
</ul>
<h1 id='calling-on-ramp-api-endpoints'>Calling <strong>ON/RAMP</strong> API endpoints</h1>
<p><strong>ON/RAMP</strong> offers a simple REST API taking JSON values as request payload, and returning JSON
values as response.</p>

<p>All calls shall be made using <strong><code>POST</code></strong> method.</p>

<p>Every call shall include the headers:</p>

<ul>
<li><p><code>Content-Type: application/json</code></p></li>
<li><p><code>X-XCO-Authorization: Bearer AUTH_TOKEN</code></p></li>
</ul>

<p>Where <code>AUTH_TOKEN</code> is replaced with merchant&#39;s API key.</p>
<h2 id='error-handling'>Error handling</h2>
<p>All ON/RAMP endpoints respect standard HTTP semantics. Errors can be detected from response
status code:</p>

<table><thead>
<tr>
<th>Status code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td><strong>200</strong></td>
<td>Everything was ok. Success.</td>
</tr>
<tr>
<td><strong>400</strong></td>
<td>Invalid request parameters. See response body.</td>
</tr>
<tr>
<td><strong>500</strong></td>
<td>Temporary ON/RAMP server malfunction.</td>
</tr>
</tbody></table>

<p>Requests resulting in 4xx errors <strong>must not be retried</strong> as-is, that will not resolve the error.</p>

<p>Requests giving 5xx errors may be retried. If retried, the retry interval must multiplicatively
increase in geometric progression, using <a href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential backoff</a>. E.g. retry 1 after 160ms, retry 2
after 320ms, retry 3 after 640ms, retry 4 after 1280ms, and so on.</p>
<h2 id='webhook-callbacks'>Webhook callbacks</h2>
<p>Some endpoints involve <em>callbacks:</em> ON/RAMP system will sometimes make requests to
Merchant-provided URLs.</p>

<p>All callbacks invoked by ON/RAMP are made using <strong><code>POST</code></strong> method.</p>

<p>In callback response, any HTTP status code besides 200 <strong>is treated as callback failure</strong>.</p>
<h1 id='server-to-server-s2s'>Server to Server (S2S)</h1>
<p><strong>Note:</strong> This API is restricted and you should only use it with previous authorization.</p>
<h2 id='flow'>Flow</h2>
<ol>
<li>Merchant makes a request to <code>/s2s/create_operation</code> endpoint.</li>
<li>Merchant gets <code>op_id</code> in the response and stores it for further usage if needed.</li>
<li><code>callback_url</code> starts receiving statuses.</li>
<li>When merchant receives <code>WAITING_USER_TO_BE_REDIRECTED</code>, they redirect the user to the provided url.</li>
<li>User follows the url, completes 3DS and gets redirected to <code>user_redirect_url</code>.</li>
<li>Steps 4 and 5 might be repeated one additional time if the acquirer deems it necessary.</li>
<li>Once the merchant receives a status that is <code>ACCEPTED</code> or <code>REJECTED</code>, the process finishes.</li>
</ol>
<h3 id='status-overview'>Status overview</h3>
<p>Here is the list of all the existing statuses and their definitions.</p>

<ul>
<li><code>PENDING</code>:
Operation has just been created.</li>
<li><code>WAITING_USER_TO_BE_REDIRECTED</code>:
3DS url has been created and user should be redirected to that.</li>
<li><code>USER_REDIRECTED</code>:
User has been redirected to the 3DS page.</li>
<li><code>PROCESSING_USER_PAYMENT</code>:
User has completed 3DS and the payment is being processed.</li>
<li><code>ACCEPTED</code>:
The payment has been accepted.</li>
<li><code>REJECTED</code>:
The payment has been rejected by the bank.</li>
<li><code>CANCELLED</code>:
Operation has been cancelled.</li>
</ul>
<h3 id='flow-diagram'>Flow diagram</h3>
<p><img src="../images/s2s_flow-11e56146.svg" alt="" /></p>
<h2 id='authentication'>Authentication</h2>
<blockquote>
<p>Header</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"x-xco-authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;API_KEY&gt;"</span><span class="w">
</span></code></pre></div>
<p>Each API Key is associated with a specific MID.</p>

<p>Operations created under a specific API key will only be visible with that API key.</p>
<h2 id='creating-an-operation'>Creating an operation</h2>
<aside class="success"><b><code>POST /s2s/create_operation</code></b></aside>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="s1">'https://api.onramp.ltd/s2s/create_operation'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000'</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{
    "op_id": "00112233-4455-6677-8899-aabbccddeeff",
    "fiat_amount": "1000",
    "fiat_currency": "EUR",
    "callback_url": "https://api.example.com/deposit-webhook",
    "user_redirect_url": "https://example.com/user/deposits",
    "customer_id": "ffeeddcc-bbaa-9988-7766-554433221100",
    "session_id": "00112233-4455-6677-8899-aabbccddeeff",
    "card_details": {
        "card_number": "4242424242424242",
        "card_expiry_month": "12",
        "card_expiry_year": "21",
        "card_cvv": "356",
        "card_holder_name": "John Doe",
        "email": "example@example.com",
        "first_name": "John",
        "last_name": "Doe",
        "country": "GBR"
    }
}'</span>
</code></pre></div><h3 id='request'>Request</h3>
<aside class="notice">
  Fields marked <b>For 3DSv2</b> need to <b>all</b> be present if you
  wish for a 3DSv2 transaction to occur.</aside>

<table>
  <tr>
    <th colspan=2>Field</th>
    <th colspan=2>Description</th>
    <th colspan=2>Type</th>
    <th colspan=2>Required</th>
  </tr>
  <tr>
    <td colspan=2>op_id</td>
    <td colspan=2>Unique ID to identify the operation. If not provided, it will be automatically generated</td>
    <td colspan=2>UUID</td>
    <td colspan=2>Optional</td>
  </tr>
  <tr>
    <td colspan=2>fiat_amount</td>
    <td colspan=2>Transaction amount, in <a href="https://en.wikipedia.org/wiki/ISO_4217#Minor_units_of_currency">minor unit</a> form</td>
    <td colspan=2>Positive integer</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>fiat_currency</td>
    <td colspan=2>Transaction currency</td>
    <td colspan=2><a href="https://en.wikipedia.org/wiki/ISO_4217#Active_codes">ISO 4217</a> alpha code</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>callback_url</td>
    <td colspan=2>URL we will return status updates to</td>
    <td colspan=2>HTTP URL</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>user_redirect_url</td>
    <td colspan=2>URL the user will be redirected to after completing 3DS</td>
    <td colspan=2>HTTP URL</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>customer_id</td>
    <td colspan=2>User identifier</td>
    <td colspan=2>String</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>session_id</td>
    <td colspan=2>Unique ID of users browsing session</td>
    <td colspan=2>String</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>card_details</td>
    <td colspan=2></td>
    <td colspan=2>Object</td>
    <td colspan=2></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>card_number</td>
    <td></td>
    <td><a href="https://en.wikipedia.org/wiki/Payment_card_number">Valid</a> credit card number</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always <b>(Not needed for bank payments)</b></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>card_expiry_month</td>
    <td></td>
    <td>Credit card expiry month</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always <b>(Not needed for bank payments)</b></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>card_expiry_year</td>
    <td></td>
    <td>Last two digits of the credit card expiry year</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always <b>(Not needed for bank payments)</b></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>card_cvv</td>
    <td></td>
    <td>Card CVV</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always <b>(Not needed for bank payments)</b></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>card_holder_name</td>
    <td></td>
    <td>Card holder's name as it appears on the card</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always <b>(Not needed for bank payments)</b></td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>first_name</td>
    <td></td>
    <td>Users first name</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>last_name</td>
    <td></td>
    <td>Users last name</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>email</td>
    <td></td>
    <td>Users email</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>phone_number</td>
    <td></td>
    <td>Users phone number</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Optional</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>street</td>
    <td></td>
    <td>Billing address street</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>city</td>
    <td></td>
    <td>Billing address city</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>postal_code</td>
    <td></td>
    <td>Billing address postcode</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>state</td>
    <td></td>
    <td>Billing address state</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">card_details.</span>country</td>
    <td></td>
    <td>Billing address country</td>
    <td></td>
    <td><a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">ISO 3166</a> alpha-3 code</td>
    <td></td>
    <td>Always</td>
  </tr>
  <tr>
    <td colspan=2>ip</td>
    <td colspan=2>Users IP address</td>
    <td colspan=2><a href="https://en.wikipedia.org/wiki/IP_address#IPv4_addresses">IPv4</a> address</td>
    <td colspan=2>Always</td>
  </tr>
  <tr>
    <td colspan=2>three_ds_data</td>
    <td colspan=2>Users session-specific browser data</td>
    <td colspan=2>Object
    <td colspan=2>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>accept_header</td>
    <td></td>
    <td>Accept header from users browser</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>challenge_window</td>
    <td></td>
    <td>Size of the authentication iframe presented to the user.
        <br>Acceptable values are:
        <br>&emsp;1 – 250 x 400
        <br>&emsp;2 – 390 x 400
        <br>&emsp;3 – 500 x 600
        <br>&emsp;4 – 600 x 400
        <br>&emsp;5 – Full screen
        <br>The default varies based on the acquirer.
    </td>
    <td></td>
    <td>Integer</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>java_enabled</td>
    <td></td>
    <td>Whether users browser can execute Java</td>
    <td></td>
    <td>Boolean</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>javascript_enabled</td>
    <td></td>
    <td>Whether users browser can execute JavaScript</td>
    <td></td>
    <td>Boolean</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>language</td>
    <td></td>
    <td>Users browser language</td>
    <td></td>
    <td><a href="https://en.wikipedia.org/wiki/IETF_language_tag">Language tag</a></td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>os</td>
    <td></td>
    <td>Users operating system</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>screen_color_depth</td>
    <td></td>
    <td>Users screen bit depth of the color palette
        <br>Accepted values are 1, 4, 8, 15, 16, 24, 32 and 48.
    </td>
    <td></td>
    <td>Integer</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>screen_height</td>
    <td></td>
    <td>Users screen height in pixels</td>
    <td></td>
    <td>Integer</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>screen_width</td>
    <td></td>
    <td>Users screen width in pixels</td>
    <td></td>
    <td>Integer</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>timezone</td>
    <td></td>
    <td>Difference between UTC and users local time <b>in minutes</b>.
        <br>This will be negative if users local time is ahead of UTC.</td>
    <td></td>
    <td>Integer</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">three_ds_data.</span>user_agent</td>
    <td></td>
    <td>UserAgent header from users browser</td>
    <td></td>
    <td>String</td>
    <td></td>
    <td>For 3DSv2</td>
  </tr>
</table>
<h3 id='response'>Response</h3>
<aside class="success">HTTP 200</aside>

<blockquote>
<p>Response Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[{</span><span class="w"> </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ffb7577-e4f9-4980-89d0-a1936f9088f4"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>Operation ID to be used as a reference</td>
<td>UUID</td>
</tr>
</tbody></table>
<h2 id='callbacks'>Callbacks</h2>
<aside class="notice">Callbacks are sent to <code>callback_url</code> provided in the <code>POST /s2s/create_operation</code> call</aside>

<p>Whenever there&#39;s a change on a operation status, a status change callback will be triggered.</p>

<p>Status change callbacks will be retried with exponential decay until they get answered.</p>

<p><strong>WARNING</strong>: in rare cases, it might be possible for status change callbacks to be duplicated or received
out of order, therefore we recommend checking the <code>date</code> field to detect these anomalies.</p>
<h3 id='request-2'>Request</h3>
<blockquote>
<p>Callback example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6cce9a4-af6d-4572-a0ab-d7bc2ad159ba"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1626971748</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"waiting_user_to_be_redirected"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.onramp.ltd/s2s/deposit"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table>
  <tr>
    <th>Field</th>
    <th>Description</th>
    <th>Type</th>
  </tr>
  <tr>
    <td>op_id</td>
    <td>Operation this status change refers to</td>
    <td>UUID</td>
  </tr>
  <tr>
    <td>date</td>
    <td>Status creation timestamp</td>
    <td>Unix time</td>
  </tr>
  <tr>
    <td>status</td>
    <td></td>
    <td>Object</td>
  </tr>
</table>
<h3 id='status-field-one-of-the-following'>Status field (one of the following)</h3>
<table>
  <tr>
    <th colspan=2>Field</th>
    <th colspan=2>Description</th>
    <th colspan=2>Type</th>
  </tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td colspan=2>pending</td>
    <td colspan=2>Initial state</td>
    <td colspan=2>Object</td>
  </tr>
  </tr>
  <tr>
    <td colspan=2>waiting_user_to_be_redirected</td>
    <td colspan=2>Waiting for merchant to redirect the user</td>
    <td colspan=2>Object</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">waiting_user_to_be_redirected.</span>number</td>
    <td></td>
    <td>Increments every time a new redirection is requested. Starts at 1.</td>
    <td></td>
    <td>HTTP URL</td>
  </tr>
  <tr></tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td></td>
    <td><span style="color:gray">waiting_user_to_be_redirected.</span>url</td>
    <td></td>
    <td>URL to redirect the user to</td>
    <td></td>
    <td>HTTP URL</td>
  </tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td colspan=2>user_redirected</td>
    <td colspan=2>Waiting for the user to complete 3DS</td>
    <td colspan=2>Object</td>
  </tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td colspan=2>processing_user_payment</td>
    <td colspan=2>Processing the payment</td>
    <td colspan=2>Object</td>
  </tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td colspan=2>accepted</td>
    <td colspan=2>Operation completed</td>
    <td colspan=2>Object</td>
  </tr>
  <tr>
    <td colspan=2>rejected</td>
    <td colspan=2>Operation was rejected by the bank/acquirer</td>
    <td colspan=2>Object</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">rejected.</span>error_code</td>
    <td></td>
    <td>Bank/acquirer error identifier</td>
    <td></td>
    <td>String</td>
  </tr>
  <tr></tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td></td>
    <td><span style="color:gray">rejected.</span>error_reason</td>
    <td></td>
    <td>Common error reason.
        <br>One of the following:
          <br>&ensp;<code>DO_NOT_HONOR</code>
          <br>&ensp;<code>3DS_DECLINED</code>
          <br>&ensp;<code>EXPIRED_CARD</code>
          <br>&ensp;<code>TRANSACTION_NOT_PERMITTED_TO_CARDHOLDER</code>
          <br>&ensp;<code>ISSUER_OFFLINE</code>
          <br>&ensp;<code>UNSUPPORTED_CARD_COUNTRY</code>
          <br>&ensp;<code>INSUFFICIENT_FUNDS</code>
          <br>&ensp;<code>UNSUPPORTED_CARD_TYPE</code>
          <br>&ensp;<code>UNSUPPORTED_CURRENCY</code>
          <br>&ensp;<code>INVALID_CARDNUMBER</code>
          <br>&ensp;<code>CVV2_FAILURE</code>
          <br>&ensp;<code>UNSPECIFIED_CC_ERR</code>
    </td>
    <td></td>
    <td>String</td>
  <tr>
    <td colspan=2>cancelled</td>
    <td colspan=2>Operation was cancelled on our side</td>
    <td colspan=2>Object</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">cancelled.</span>reason</td>
    <td></td>
    <td>Action that caused the operation cancellation.
        <br>One of the following:
          <br>&ensp;<code>MANUAL_CANCELLATION</code>
    </td>
    <td></td>
    <td>String</td>
  </tr>
  <tr>
    <td colspan=2>received</td>
    <td colspan=2>Funds have been transferred successfully</td>
    <td colspan=2>Object</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">received.</span>data</td>
    <td></td>
    <td>Bank-specific data. May be null.</td>
    <td></td>
    <td>Object</td>
  </tr>
  <tr>
    <td colspan=2>not_received</td>
    <td colspan=2>Funds could not be transferred</td>
    <td colspan=2>Object</td>
  </tr>
  <tr></tr>
  <tr>
    <td></td>
    <td><span style="color:gray">not_received.</span>data</td>
    <td></td>
    <td>Bank-specific data. May be null.</td>
    <td></td>
    <td>Object</td>
  </tr>


</table>
<h3 id='response-2'>Response</h3>
<aside class="success">HTTP 200</aside>

<blockquote>
<p>Response Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"request_attempt_cancel"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Note: If an unknown status is sent, merchant should respond with <code>continue</code></p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"continue"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>action</td>
<td></td>
<td>Object</td>
</tr>
</tbody></table>
<h3 id='action-one-of-the-following'>Action (one of the following)</h3>
<table>
  <tr>
    <th>Field</th>
    <th>Description</th>
    <th>Type</th>
  </tr>
  <tr style="border-bottom:0.5px dashed gray">
    <td>request_attempt_cancel</td>
    <td>Attempt to cancel the operation.
        This is not guaranteed to succeed.</td>
    <td>Object</td>
  </tr>
  <tr>
    <td>continue</td>
    <td>Simply acknowledge the callback has been received.</td>
    <td>Object</td>
  </tr>
</table>
<h2 id='retrieving-operation-statuses'>Retrieving operation statuses</h2>
<aside class="success"><b><code>GET /s2s/operation_status?op_id={op_id}</code></b></aside>

<p>This endpoint can be used to query the status of an operation.</p>

<p>It returns the list of status changes related to the given event.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="s1">'https://api.onramp.ltd/s2s/operation_status?op_id=7ffb7577-e4f9-4980-89d0-a1936f9088f4'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000'</span>
</code></pre></div><h3 id='request-3'>Request</h3>
<aside class="notice">Empty body</aside>
<h3 id='response-3'>Response</h3>
<aside class="success">HTTP 200</aside>

<p>Returns a list of <a href="#callbacks">callbacks</a>.</p>
<h2 id='updating-an-operation'>Updating an operation</h2>
<aside class="success"><b><code>POST /s2s/update_operation</code></b></aside>

<p>Send an action to a given operation.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="s1">'https://api.onramp.ltd/s2s/update_operation'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
<span class="nt">-H</span> <span class="s1">'x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000'</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{
    "op_id": "5b99dfb2-ef07-4fb7-9d20-62d63ce0f737",
    "action": {
        "request_attempt_cancel": {}
    }
}'</span>
</code></pre></div><h3 id='request-4'>Request</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>ID of the operation to be updated.</td>
<td>UUID</td>
</tr>
<tr>
<td>action</td>
<td>Same action as in the response part of the <a href="#callbacks">callbacks section</a></td>
<td>Object</td>
</tr>
</tbody></table>
<h3 id='response-4'>Response</h3>
<aside class="success">HTTP 200</aside>

<aside class="notice">Empty body</aside>
<h2 id='testing'>Testing</h2>
<p>On the testing environment several CVVs behave differently:</p>

<p>&emsp;<code>001</code> — payment is immediately accepted;</p>

<p>&emsp;<code>002</code> — payment goes through mocked 3DSv1 detached from any payment system;</p>

<p>&emsp;<code>003</code> — payment is immediately rejected.</p>

<p>&emsp;<code>004</code> — payment goes through mocked 3DSv2 detached from any payment system;</p>

<aside class="notice">These test cases jump certain status change callbacks, notably <code>pending</code> and <code>processing_user_payment</code>, but they will still be visible on <b><code>GET /s2s/operation_status</code></b></aside>
<h2 id='bank-payments-flow'>Bank payments flow</h2>
<p>As a clarification, our ingress flow currently supports both paying with credit card and with our bank payments solution.</p>

<p><strong>In order to be able to use that, you need to get a specific API key from us.</strong></p>

<p>For how the flow works or what parameters are needed to be used, you can see above on the technical specifications how:</p>

<ul>
<li>Flow is exactly the same as in a 3DS transaction, but instead the user seeing an OTP screen to confirm the transaction, they will see a page where they will be able to choose from the available banks and continue the process.</li>
<li>The parameters required are exactly the same as on the credit card payment, but except for the credit card data since this is a bank payment flow. This means the same current implementation you may have for credit card payment will work if you just remove the credit card parameters (<code>card_number, card_expiry_month, card_expiry_year, card_cvv, card_holder_name</code>).</li>
</ul>
<h2 id='api-changes-amp-backwards-compatibility'>API changes &amp; backwards compatibility:</h2>
<p>To keep flexibility for future new features without losing backward compatibility, we ask you:</p>

<ul>
<li><p>To assume that any JSON could contain extra fields not specified within this document;</p></li>
<li><p>To answer unknown types of status changes with <code>continue</code>.</p></li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
          </div>
      </div>
    </div>
  </body>
</html>
