
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ON/RAMP payment API v1.4.3</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-697acf91.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-a9fde460.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-86952380.png" class="logo" alt="" />
        <span class="toc-link">API v1.4.3</span>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#on-ramp-merchant-integration" class="toc-h1 toc-link" data-title="ON/RAMP merchant integration.">ON/RAMP merchant integration.</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#terminology-and-acronyms" class="toc-h2 toc-link" data-title="Terminology and Acronyms">Terminology and Acronyms</a>
                  </li>
                  <li>
                    <a href="#base-url" class="toc-h2 toc-link" data-title="Base URL">Base URL</a>
                  </li>
                  <li>
                    <a href="#changelog" class="toc-h2 toc-link" data-title="Changelog">Changelog</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#calling-on-ramp-api-endpoints" class="toc-h1 toc-link" data-title="Calling ON/RAMP API endpoints">Calling <strong>ON/RAMP</strong> API endpoints</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#error-handling" class="toc-h2 toc-link" data-title="Error handling">Error handling</a>
                  </li>
                  <li>
                    <a href="#webhook-callbacks" class="toc-h2 toc-link" data-title="Webhook callbacks">Webhook callbacks</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#api-flows" class="toc-h1 toc-link" data-title="API flows">API flows</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#ingress-flow" class="toc-h2 toc-link" data-title="Ingress flow">Ingress flow</a>
                  </li>
                  <li>
                    <a href="#app-egress-flow" class="toc-h2 toc-link" data-title="App Egress flow">App Egress flow</a>
                  </li>
                  <li>
                    <a href="#email-egress-flow" class="toc-h2 toc-link" data-title="Email Egress flow">Email Egress flow</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#invoice-expiration" class="toc-h1 toc-link" data-title="Invoice expiration">Invoice expiration</a>
          </li>
          <li>
            <a href="#ingress-api" class="toc-h1 toc-link" data-title="Ingress API">Ingress API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#create-ingress-invoice" class="toc-h2 toc-link" data-title="Create Ingress Invoice">Create Ingress Invoice</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#egress-api" class="toc-h1 toc-link" data-title="Egress API">Egress API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#create-egress-invoice-app-redirection-flow" class="toc-h2 toc-link" data-title="Create Egress Invoice (App redirection flow)">Create Egress Invoice (App redirection flow)</a>
                  </li>
                  <li>
                    <a href="#create-egress-invoice-user-email-flow" class="toc-h2 toc-link" data-title="Create Egress Invoice (User email flow)">Create Egress Invoice (User email flow)</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#payment-lifecycle-api" class="toc-h1 toc-link" data-title="Payment lifecycle API">Payment lifecycle API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#mark-operation" class="toc-h2 toc-link" data-title="Mark Operation">Mark Operation</a>
                  </li>
                  <li>
                    <a href="#poll-operation-status" class="toc-h2 toc-link" data-title="Poll Operation status">Poll Operation status</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#ingress-iframe-integration" class="toc-h1 toc-link" data-title="Ingress iframe integration">Ingress iframe integration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#adding-the-iframe-in-a-html-page" class="toc-h2 toc-link" data-title="Adding the iframe in a html page">Adding the iframe in a html page</a>
                  </li>
                  <li>
                    <a href="#communicating-with-the-iframe-events" class="toc-h2 toc-link" data-title="Communicating with the iframe events">Communicating with the iframe events</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#crypto-iframe-integration" class="toc-h1 toc-link" data-title="Crypto iframe integration">Crypto iframe integration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#adding-the-iframe-in-a-html-page" class="toc-h2 toc-link" data-title="Adding the iframe in a html page">Adding the iframe in a html page</a>
                  </li>
                  <li>
                    <a href="#communicating-with-the-iframe-events" class="toc-h2 toc-link" data-title="Communicating with the iframe events">Communicating with the iframe events</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#crypto-ingress-flow" class="toc-h1 toc-link" data-title="Crypto Ingress Flow">Crypto Ingress Flow</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#user-request-a-crypto-address" class="toc-h2 toc-link" data-title="User request a Crypto Address">User request a Crypto Address</a>
                  </li>
                  <li>
                    <a href="#on-ramp-notify-merchant-on-new-crypto-funds" class="toc-h2 toc-link" data-title="ON/RAMP notify Merchant on new Crypto Funds">ON/RAMP notify Merchant on new Crypto Funds</a>
                  </li>
                  <li>
                    <a href="#merchant-create-new-crypto-invoice" class="toc-h2 toc-link" data-title="Merchant Create new Crypto Invoice">Merchant Create new Crypto Invoice</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#server-to-server-s2s" class="toc-h1 toc-link" data-title="Server to Server (S2S)">Server to Server (S2S)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#steps" class="toc-h2 toc-link" data-title="Steps">Steps</a>
                  </li>
                  <li>
                    <a href="#authentication" class="toc-h2 toc-link" data-title="Authentication">Authentication</a>
                  </li>
                  <li>
                    <a href="#status-definition" class="toc-h2 toc-link" data-title="Status definition">Status definition</a>
                  </li>
                  <li>
                    <a href="#callbacks" class="toc-h2 toc-link" data-title="Callbacks">Callbacks</a>
                  </li>
                  <li>
                    <a href="#get-credit-card-fields" class="toc-h2 toc-link" data-title="Get credit card fields">Get credit card fields</a>
                  </li>
                  <li>
                    <a href="#create-operation" class="toc-h2 toc-link" data-title="Create Operation">Create Operation</a>
                  </li>
                  <li>
                    <a href="#operation-status" class="toc-h2 toc-link" data-title="Operation status">Operation status</a>
                  </li>
                  <li>
                    <a href="#update-operation" class="toc-h2 toc-link" data-title="Update Operation">Update Operation</a>
                  </li>
                  <li>
                    <a href="#testing" class="toc-h2 toc-link" data-title="Testing">Testing</a>
                  </li>
                  <li>
                    <a href="#api-changes-amp-backward-compatibility" class="toc-h2 toc-link" data-title="API changes &amp; backward compatibility:">API changes &amp; backward compatibility:</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#quotes-api" class="toc-h1 toc-link" data-title="Quotes API">Quotes API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#base-url" class="toc-h2 toc-link" data-title="Base URL">Base URL</a>
                  </li>
                  <li>
                    <a href="#get-reference-prices" class="toc-h2 toc-link" data-title="Get reference prices">Get reference prices</a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='on-ramp-merchant-integration'>ON/RAMP merchant integration.</h1><h2 id='terminology-and-acronyms'>Terminology and Acronyms</h2>
<ul>
<li> Merchant: The service using <strong>ON/RAMP</strong> as payment processor.</li>
<li><p>User: The physical person who sends or receives funds to/from the merchant through <strong>ON/RAMP</strong>.</p></li>
<li><p>CC: credit card.</p></li>
</ul>
<h2 id='base-url'>Base URL</h2>
<p>Production:
<strong><a href="https://api.onramp.ltd">https://api.onramp.ltd/rpc</a></strong></p>

<p>Test:
<strong><a href="https://stage-api.onramp.ltd">https://stage-api.onramp.ltd/rpc</a></strong></p>
<h2 id='changelog'>Changelog</h2>
<p>Changes since v1.4.2:</p>

<ul>
<li> Add fee_rate field for payment_ack_url payload example</li>
</ul>

<p>Changes since v1.4.1:</p>

<ul>
<li> Update payment_ack_url payload example</li>
</ul>
<h1 id='calling-on-ramp-api-endpoints'>Calling <strong>ON/RAMP</strong> API endpoints</h1>
<p><strong>ON/RAMP</strong> offers a simple REST API taking JSON values as request payload, and returning JSON
values as response.</p>

<p>All calls shall be made using <strong><code>POST</code></strong> method.</p>

<p>Every call shall include the headers:</p>

<ul>
<li><p><code>Content-Type: application/json</code></p></li>
<li><p><code>X-XCO-Authorization: Bearer AUTH_TOKEN</code></p></li>
</ul>

<p>Where <code>AUTH_TOKEN</code> is replaced with merchant&#39;s API key.</p>
<h2 id='error-handling'>Error handling</h2>
<p>All ON/RAMP endpoints respect standard HTTP semantics. Errors can be detected from response
status code:</p>

<table><thead>
<tr>
<th>Status code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td><strong>200</strong></td>
<td>Everything was ok. Success.</td>
</tr>
<tr>
<td><strong>400</strong></td>
<td>Invalid request parameters. See response body.</td>
</tr>
<tr>
<td><strong>500</strong></td>
<td>Temporary ON/RAMP server malfunction.</td>
</tr>
</tbody></table>

<p>Requests resulting in 4xx errors <strong>must not be retried</strong> as-is, that will not resolve the error.</p>

<p>Requests giving 5xx errors may be retried. If retried, the retry interval must multiplicatively
increase in geometric progression, using <a href="https://en.wikipedia.org/wiki/Exponential_backoff">exponential backoff</a>. E.g. retry 1 after 160ms, retry 2
after 320ms, retry 3 after 640ms, retry 4 after 1280ms, and so on.</p>
<h2 id='webhook-callbacks'>Webhook callbacks</h2>
<p>Some endpoints involve <em>callbacks:</em> ON/RAMP system will sometimes make requests to
Merchant-provided URLs.</p>

<p>All callbacks invoked by ON/RAMP are made using <strong><code>POST</code></strong> method.</p>

<p>In callback response, any HTTP status code besides 200 <strong>is treated as callback failure</strong>.</p>
<h1 id='api-flows'>API flows</h1><h2 id='ingress-flow'>Ingress flow</h2>
<ol>
<li><p>Merchant <a href="#create-ingress-invoice">creates an ingress invoice url</a>.</p></li>
<li><p>Merchant redirects user to the returned <code>invoice_url</code>.</p></li>
<li><p><strong>ON/RAMP</strong> handles the payment.</p></li>
<li><p>Once the payment gets cleared, <strong>ON/RAMP</strong> will <a href="#callback-ingress-invoice">call back the merchant</a>
to finalize the transaction.</p></li>
<li><p><strong>ON/RAMP</strong> redirects the user back to merchant.</p></li>
</ol>
<h2 id='app-egress-flow'>App Egress flow</h2>
<ol>
<li><p>Merchant <a href="#create-egress-invoice-app-redirection-flow">creates an egress invoice url</a>.</p></li>
<li><p>Merchant redirects user to the returned <code>invoice_url</code>.</p></li>
<li><p><strong>ON/RAMP</strong> gathers required user&#39;s data and consent.
If the payment is not feasible or was rejected by the user, it will fail at this point.</p></li>
<li><p><strong>ON/RAMP</strong> <a href="#callback-egress-invoice">calls back the merchant</a> returning a reference for execution.</p></li>
<li><p>Merchant accepts, rejects or postpones the egress payment.</p></li>
<li><p>If postponed in the callback, merchant will have up to 3 days to <a href="#mark-operation">accept or reject it</a>.</p></li>
<li><p>The payment will get automatically rejected if merchant fails to approve or reject within
the 72 hours timeout.</p></li>
</ol>
<h2 id='email-egress-flow'>Email Egress flow</h2>
<ol>
<li><p>Merchant <a href="#create-egress-invoice-user-email-flow">creates a user email egress invoice</a>.</p></li>
<li><p><strong>ON/RAMP</strong> prepares the payment and returns <code>invoice_id</code> reference.
Merchant can decide whether to accept any user or only users previously registered on
<strong>ON/RAMP</strong> using the <code>accept_unregister_user</code> option.
On success, the returned <code>invoice_id</code> reference shall be used by the Merchant
to <a href="#mark-operation">accept or reject</a> the payment.</p></li>
<li><p>Merchants will have up to 3 days to accept or reject the payment, unless the option <code>required_merchant_confirmation</code>
is set to <code>false</code>, in which case it will be always considered accepted by the merchant.</p></li>
<li><p>If the user is not already registered, <strong>ON/RAMP</strong> will send emails to the user requesting his/her registration.
Users will have up to 3 days to register. If they don&#39;t, the egress payment will get cancelled <strong>even if it was previously
accepted by the merchant</strong>.</p></li>
</ol>
<h1 id='invoice-expiration'>Invoice expiration</h1>
<p>Each invoice expires after the timeout given on creation, or once it has been paid. This ensures
that the user can not accidentally pay twice for the same ingress invoice, nor get paid twice from
the same egress invoice.</p>

<p>As a consequence, the merchant must create a new invoice every time a user requests a payment.
If a user clicks on an expired invoice, they will get redirected back to the merchant.</p>
<h1 id='ingress-api'>Ingress API</h1><h2 id='create-ingress-invoice'>Create Ingress Invoice</h2>
<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/create_ingress_invoice                                    <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{ "fiat_amount"             : 3000
              , "fiat_currency"           : "EUR"
              , "payment_ack_url"         : "https://www.example.com"
              , "user_redirect_url"       : "https://www.example.com?user_redirected"
              , "timeout_in_sec"          : 3600
              , "offer_skin"              :
                  { "title" : "The Nice merchant"
                  , "image" : "https://static.example.com/merchant-logo"
                  , "description": "Awesome green Pluff with handler"
                  }
              , "billing_details"    :
                  { "payer_email"            : "mrpayer.payerson@email.com"
                  , "payer_first_name"       : "MrPayer"
                  , "payer_last_name"        : "Payerson"
                  , "payer_phone"            : "0034666444446"
                  , "birth_date"             : "1980-11-24 00:00:00.000000+00"
                  , "street"                 : "Main Street"
                  , "unit"                   : "Floor 7 12B"
                  , "postal_code"            : "0000001"
                  , "city"                   : "Big Town"
                  , "county"                 : "Big Town county"
                  , "state"                  : "CA"
                  , "prefecture"             : "Prefecture-ku"
                  , "country"                : "GBR"
                  , "kyc_verified"           : "2020-01-01 12:45:00.000000+00"
                  , "kyc_document"           : "Passport"
                  , "kyc_reference"          : "25177aa2-d848-846d-226c-97ec3096f5fe"
                  , "address_verified"       : "2020-01-01 12:55:00.000000+00"
                  , "address_doc_reference"  : "3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"
                  , "player_level"           : "New"
                  , "member_since"           : "2020-01-01 12:35:00.000000+00"
                  , "merchant_customer_id"   : "u2340112"
                  }
              , "card_number"             : "4929421234600821"
              , "card_expiry_date"        : "2030-12-01"
              , "card_cvv"                : "356"
              , "card_holder_first_name"  : "John"
              , "card_holder_last_name"   : "Smith"
              }'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"fiat_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fiat_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"payment_ack_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.com?user_redirected"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timeout_in_sec"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offer_skin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Nice merchant"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://static.example.com/merchant-logo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Awesome green Pluff with handler"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"billing_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"payer_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mrpayer.payerson@email.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MrPayer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payerson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0034666444446"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"birth_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1980-11-24 00:00:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Main Street"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Floor 7 12B"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"county"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town county"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"prefecture"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Prefecture-ku"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:45:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passport"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25177aa2-d848-846d-226c-97ec3096f5fe"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:55:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_doc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"player_level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"member_since"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:35:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"merchant_customer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"u2340112"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"card_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4929421234600821"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"card_expiry_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2030-12-01"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"card_cvv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"356"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"card_holder_first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"card_holder_last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"invoice_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"62b570e8-9723-4287-a5a8-e825c2ffced2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"invoice_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://wallet.onramp.ltd/ingressing?reference=a3076265-138d-4be6-89fb-d50427adaf4e"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"invoice_url_qr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.onramp.ltd/qr_encode/68747470733a2f2f73746167652d77616c6c65742e6f6e72616d702e6c74642f656772657373696e673f7265666572656e63653d38303061343437382d393832322d343561382d616239302d323637306665393262343933"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><h3 id='http-request'>HTTP Request</h3>
<aside class="success"><b><code> POST /rpc/create_ingress_invoice </code></b></aside>
<h3 id='request-json-fields'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_amount</td>
<td>Integer</td>
<td>Amount to be paid denominated in cents .</td>
<td>Yes</td>
</tr>
<tr>
<td>fiat_currency</td>
<td>String</td>
<td>Currency identifier following the <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217 standard</a>. Valid values are <code>&quot;EUR&quot;</code> or <code>&quot;USD&quot;</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>payment_ack_url</td>
<td>Url</td>
<td>Merchant callback endpoint to confirm ingress transaction. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>user_redirect_url</td>
<td>Url</td>
<td>Where to redirect the user after a successful payment. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>timeout_in_sec</td>
<td>Integer</td>
<td>When to expire the link if unused.</td>
<td>Yes</td>
</tr>
<tr>
<td>offer_skin</td>
<td>Ingress Skin</td>
<td>Specify how the offer should be displayed to the user.</td>
<td>Yes</td>
</tr>
<tr>
<td>billing_details</td>
<td>Billing Details</td>
<td>User billing details. Please, notice how <strong>not</strong> all parameters inside this json object are required except <code>merchant_customer_id</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>cancel_callback</td>
<td>Url</td>
<td>Merchant callback endpoint to be called when an ingress payment couldn&#39;t be completed.</td>
<td>No</td>
</tr>
<tr>
<td>card_number</td>
<td>String</td>
<td>Credit card number to be used to attempt the payment. If not sent, no credit card details will be prefilled.</td>
<td>No</td>
</tr>
<tr>
<td>card_expiry_date</td>
<td>String</td>
<td>Credit card expiry date to be used to attempt the payment.</td>
<td>No</td>
</tr>
<tr>
<td>card_cvv</td>
<td>String</td>
<td>Credit card CVV to be used to attempt the payment.</td>
<td>No</td>
</tr>
<tr>
<td>card_holder_first_name</td>
<td>String</td>
<td>Credit card cardholder first name to be used to attempt the payment.</td>
<td>No</td>
</tr>
<tr>
<td>card_holder_last_name</td>
<td>String</td>
<td>Credit card cardholder last name to attempt the payment.</td>
<td>No</td>
</tr>
</tbody></table>
<h3 id='ingress-skin'>Ingress Skin</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>String</td>
<td>Short string containing merchant&#39;s or product&#39;s name.</td>
<td>Yes</td>
</tr>
<tr>
<td>image</td>
<td>Url</td>
<td>image to stylize the offer.</td>
<td>Yes</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A text explaining what the user is purchasing.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='billing-details'>Billing Details</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>payer_email</td>
<td>Email</td>
<td>Email of the user making the payment.</td>
<td>Yes</td>
</tr>
<tr>
<td>payer_first_name</td>
<td>String</td>
<td>First name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_last_name</td>
<td>String</td>
<td>Last name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_phone</td>
<td>String</td>
<td>Including country code, without spaces or separators.</td>
<td>No</td>
</tr>
<tr>
<td>birth_date</td>
<td>Date</td>
<td>Date of birth of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>street</td>
<td>String</td>
<td>Street from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>unit</td>
<td>String</td>
<td>Unit from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>postal_code</td>
<td>String</td>
<td>Postal code from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>county</td>
<td>String</td>
<td>County from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>State from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>prefecture</td>
<td>String</td>
<td>Prefecture from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>Country from the billing address. Should be a 3 letter ISO Code.</td>
<td>Yes</td>
</tr>
<tr>
<td>kyc_verified</td>
<td>Date</td>
<td>Date when the user was KYC verified.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_document</td>
<td>String</td>
<td>Type of the document. Some examples would be Passport or National_ID.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_reference</td>
<td>String</td>
<td>A unique id of the KYC verification. Something like a UUID.</td>
<td>No</td>
</tr>
<tr>
<td>address_verified</td>
<td>Date</td>
<td>Date when the address was verified.</td>
<td>No</td>
</tr>
<tr>
<td>address_doc_reference</td>
<td>String</td>
<td>A unique id of the address document reference.</td>
<td>No</td>
</tr>
<tr>
<td>player_level</td>
<td>String</td>
<td>Your internal player level. Something like New, Normal, VIP, ...</td>
<td>No</td>
</tr>
<tr>
<td>member_since</td>
<td>Date</td>
<td>The date since that user is a member of yours.</td>
<td>No</td>
</tr>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='callback-ingress-invoice'>Callback Ingress Invoice</h3>
<p>Once <strong>ON/RAMP</strong> is ready to commit the payment, it will call back merchant to confirm. <strong>It is only at this point
when the user transaction should be consider done and credited at merchant&#39;s side</strong>. If the merchant was able to
credit the user, then it should answer the callback with an http 200 status code; if the merchant was unable to
credit the user, it should answer with an http 204 status code (this will cancel the user payment, expiring his
invoice link). <strong>Any other status code</strong> but 200 or 204 <strong>will be treated as an internal error from the merchant side</strong>,
pausing the user payment and prompting manual intervention, potentially delaying the process several hours.</p>

<blockquote>
<p>IMPORTANT: This callback is going to be done with <strong>HTTP POST</strong> method and not with GET, either for <code>payment_ack_url</code> or <code>cancel_url</code>.</p>

<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"reference"</span><span class="p">:</span><span class="s2">"ac400127-93a9-4b9c-9612-c23a3c078933"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>OR</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"reference"</span><span class="p">:</span><span class="s2">"ac400127-93a9-4b9c-9612-c23a3c078933"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"crypto_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USDT"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">100.00</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fee_rate"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.065</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='response-json-fields'>Response JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invoice_id</td>
<td>String</td>
<td>Internal <strong>ON/RAMP</strong>&#39;s Invoice Identifier.</td>
</tr>
<tr>
<td>invoice_url</td>
<td>Url</td>
<td>Url where to redirect user.</td>
</tr>
<tr>
<td>invoice_url_qr</td>
<td>Url</td>
<td>Source Url for an image with QR-encoded <code>invoice_url</code></td>
</tr>
</tbody></table>
<h1 id='egress-api'>Egress API</h1><h2 id='create-egress-invoice-app-redirection-flow'>Create Egress Invoice (App redirection flow)</h2>
<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/create_egress_invoice                     <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                     <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{ "fiat_amount"        : 3000
              , "fiat_currency"      : "EUR"
              , "payment_ack_url"    : "https://www.example.com"
              , "user_redirect_url"  : "https://www.example.com?user_redirected"
              , "timeout_in_sec"     : 3600
              , "offer_skin"         :
                  { "title" : "The Nice merchant"
                  , "image" : "https://static.example.com/merchant-logo"
                  , "description": "¥‎435.22 redemption from your account"
                  }
              , "billing_details"    :
                  { "payer_email"            : "mrpayer.payerson@email.com"
                  , "payer_first_name"       : "MrPayer"
                  , "payer_last_name"        : "Payerson"
                  , "payer_phone"            : "0034666444446"
                  , "birth_date"             : "1980-11-24 00:00:00.000000+00"
                  , "street"                 : "Main Street"
                  , "unit"                   : "Floor 7 12B"
                  , "postal_code"            : "0000001"
                  , "city"                   : "Big Town"
                  , "county"                 : "Big Town county"
                  , "state"                  : "CA"
                  , "prefecture"             : "Prefecture-ku"
                  , "country"                : "GBR"
                  , "kyc_verified"           : "2020-01-01 12:45:00.000000+00"
                  , "kyc_document"           : "Passport"
                  , "kyc_reference"          : "25177aa2-d848-846d-226c-97ec3096f5fe"
                  , "address_verified"       : "2020-01-01 12:55:00.000000+00"
                  , "address_doc_reference"  : "3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"
                  , "player_level"           : "New"
                  , "member_since"           : "2020-01-01 12:35:00.000000+00"
                  , "merchant_customer_id"   : "u2340112"
                  }
              }'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"fiat_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fiat_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"payment_ack_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.com?user_redirected"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timeout_in_sec"</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offer_skin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Nice merchant"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://static.example.com/merchant-logo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"¥‎435.22 redemption from your account"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"billing_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"payer_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mrpayer.payerson@email.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MrPayer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payerson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0034666444446"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"birth_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1980-11-24 00:00:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Main Street"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Floor 7 12B"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"county"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town county"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"prefecture"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Prefecture-ku"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:45:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passport"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25177aa2-d848-846d-226c-97ec3096f5fe"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:55:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_doc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"player_level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"member_since"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:35:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"merchant_customer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"u2340112"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"invoice_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cde6f458-8754-4ffe-81a9-77c6d05a5540"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"invoice_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://wallet.onramp.ltd/egressing?reference=cde6f458-8754-4ffe-81a9-77c6d05a5540"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"invoice_url_qr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.onramp.ltd/qr_encode/68747470733a2f2f73746167652d77616c6c65742e6f6e72616d702e6c74642f696e6772657373696e673f7265666572656e63653d65646361623662342d343464342d343763652d396261322d366636656562626661313567"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><h3 id='http-request'>HTTP Request</h3>
<aside class="success"><b><code> POST /rpc/create_egress_invoice </code></b></aside>
<h3 id='request-json-fields'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_amount</td>
<td>Integer</td>
<td>Amount to be paid denominated in cents.</td>
<td>Yes</td>
</tr>
<tr>
<td>fiat_currency</td>
<td>String</td>
<td>Currency identifier following the <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217 standard</a>. Valid values are <code>&quot;EUR&quot;</code> or <code>&quot;USD&quot;</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>payment_ack_url</td>
<td>Url</td>
<td>Merchant callback endpoint to confirm egress transaction. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>user_redirect_url</td>
<td>Url</td>
<td>Where to redirect the user after the egress has been confirmed. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>timeout_in_sec</td>
<td>Integer</td>
<td>When to expire the link if unused.</td>
<td>Yes</td>
</tr>
<tr>
<td>offer_skin</td>
<td>Egress Skin</td>
<td>Specify how the offer should be displayed to the user.</td>
<td>Yes</td>
</tr>
<tr>
<td>billing_details</td>
<td>Billing Details</td>
<td>User billing details. Please, notice how <strong>not</strong> all parameters inside this json object are required except <code>merchant_customer_id</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>cancel_callback</td>
<td>Url</td>
<td>Merchant callback endpoint to be called when an egress payment couldn&#39;t be completed</td>
<td>No</td>
</tr>
</tbody></table>
<h3 id='egress-skin'>Egress Skin</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>String</td>
<td>Short string containing merchant&#39;s or redemption&#39;s name.</td>
<td>Yes</td>
</tr>
<tr>
<td>image</td>
<td>Url</td>
<td>Image to stylize the offer.</td>
<td>Yes</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A text explaining what the user is redeeming.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='billing-details'>Billing Details</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>payer_email</td>
<td>Email</td>
<td>Email of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_first_name</td>
<td>String</td>
<td>First name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_last_name</td>
<td>String</td>
<td>Last name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_phone</td>
<td>String</td>
<td>Including country code, without spaces or separators.</td>
<td>No</td>
</tr>
<tr>
<td>birth_date</td>
<td>Date</td>
<td>Date of birth of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>street</td>
<td>String</td>
<td>Street from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>unit</td>
<td>String</td>
<td>Unit from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>postal_code</td>
<td>String</td>
<td>Postal code from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>county</td>
<td>String</td>
<td>County from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>State from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>prefecture</td>
<td>String</td>
<td>Prefecture from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>Country from the billing address. Should be a 3 letter ISO Code.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_verified</td>
<td>Date</td>
<td>Date when the user was KYC verified.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_document</td>
<td>String</td>
<td>Type of the document. Some examples would be Passport or National_ID.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_reference</td>
<td>String</td>
<td>A unique id of the KYC verification. Something like a UUID.</td>
<td>No</td>
</tr>
<tr>
<td>address_verified</td>
<td>Date</td>
<td>Date when the address was verified.</td>
<td>No</td>
</tr>
<tr>
<td>address_doc_reference</td>
<td>String</td>
<td>A unique id of the address document reference.</td>
<td>No</td>
</tr>
<tr>
<td>player_level</td>
<td>String</td>
<td>Your internal player level. Something like New, Normal, VIP, ...</td>
<td>No</td>
</tr>
<tr>
<td>member_since</td>
<td>Date</td>
<td>The date since that user is a member of yours.</td>
<td>No</td>
</tr>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='callback-egress-invoice'>Callback Egress Invoice</h3>
<p>Once <strong>ON/RAMP</strong> is ready to commit the payment, it will call back merchant to confirm. <strong>It is only at this point
when the user transaction should be consider done and be debited at merchant&#39;s side</strong>. If the merchant was able to
debit the user, then it should answer the callback with an http 200 status code; if the merchant was unable to
debit the user, it should answer with an http 204 status code (this will cancel the user payment, expiring his
invoice link). <strong>Any other status code</strong> but 200 or 204 <strong>will be treated as an internal error from the merchant side</strong>,
pausing the user payment and prompting manual intervention, potentially delaying the process several hours.</p>

<blockquote>
<p>IMPORTANT: This callback is going to be done with <strong>HTTP POST</strong> method and not with GET, either for <code>payment_ack_url</code> or <code>cancel_url</code>.</p>
</blockquote>
<h3 id='response-json-fields'>Response JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invoice_id</td>
<td>String</td>
<td>Internal <strong>ON/RAMP</strong>&#39;s Invoice Identifier.</td>
</tr>
<tr>
<td>invoice_url</td>
<td>Url</td>
<td>Url where to redirect user.</td>
</tr>
<tr>
<td>invoice_url_qr</td>
<td>Url</td>
<td>Source Url for an image with QR-encoded <code>invoice_url</code></td>
</tr>
</tbody></table>
<h2 id='create-egress-invoice-user-email-flow'>Create Egress Invoice (User email flow)</h2>
<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/send_funds_to_email                           <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>       <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                         <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{ "fiat_amount"        : 3000
              , "fiat_currency"      : "EUR"
              , "user_redirect_url"  : "https://www.example.com?user_redirected"
              , "offer_skin"         :
                  { "title" : "The Nice merchant"
                  , "image" : "https://static.example.com/merchant-logo"
                  , "description": "¥435.22 redemption from your account"
                  }
              , "onramp_user_email"  : "user@example.com"
              , "billing_details"    :
                  { "payer_email"            : "mrpayer.payerson@email.com"
                  , "payer_first_name"       : "MrPayer"
                  , "payer_last_name"        : "Payerson"
                  , "payer_phone"            : "0034666444446"
                  , "birth_date"             : "1980-11-24 00:00:00.000000+00"
                  , "street"                 : "Main Street"
                  , "unit"                   : "Floor 7 12B"
                  , "postal_code"            : "0000001"
                  , "city"                   : "Big Town"
                  , "county"                 : "Big Town county"
                  , "state"                  : "CA"
                  , "prefecture"             : "Prefecture-ku"
                  , "country"                : "GBR"
                  , "kyc_verified"           : "2020-01-01 12:45:00.000000+00"
                  , "kyc_document"           : "Passport"
                  , "kyc_reference"          : "25177aa2-d848-846d-226c-97ec3096f5fe"
                  , "address_verified"       : "2020-01-01 12:55:00.000000+00"
                  , "address_doc_reference"  : "3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"
                  , "player_level"           : "New"
                  , "member_since"           : "2020-01-01 12:35:00.000000+00"
                  , "merchant_customer_id"   : "u2340112"
                  }
              }'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"fiat_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fiat_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"user_redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.com?user_redirected"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"offer_skin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Nice merchant"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://static.example.com/merchant-logo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"¥‎435.22 redemption from your account"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"onramp_user_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user@example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"billing_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"payer_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mrpayer.payerson@email.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MrPayer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payerson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payer_phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0034666444446"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"birth_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1980-11-24 00:00:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Main Street"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Floor 7 12B"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"county"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town county"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"prefecture"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Prefecture-ku"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:45:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passport"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kyc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25177aa2-d848-846d-226c-97ec3096f5fe"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_verified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:55:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"address_doc_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"player_level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"member_since"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:35:00.000000+00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"merchant_customer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"u2340112"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"invoice_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cde6f458-8754-4ffe-81a9-77c6d05a5540"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><h3 id='http-request-2'>HTTP Request</h3>
<aside class="success"><b><code> POST /rpc/send_funds_to_email </code></b></aside>
<h3 id='request-json-fields-2'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_amount</td>
<td>Integer</td>
<td>Amount to be paid denominated in cents.</td>
<td>Yes</td>
</tr>
<tr>
<td>fiat_currency</td>
<td>String</td>
<td>Currency identifier following the <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217 standard</a>. Valid values are <code>&quot;EUR&quot;</code> or <code>&quot;USD&quot;</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>user_redirect_url</td>
<td>Url</td>
<td>Where to redirect the user after the egress has been confirmed. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>offer_skin</td>
<td>Egress Skin</td>
<td>Specify how the offer should be displayed to the user (It might not be shown in this flow).</td>
<td>Yes</td>
</tr>
<tr>
<td>billing_details</td>
<td>Billing Details</td>
<td>User billing details. Please, notice how <strong>not</strong> all parameters inside this json object are required except <code>merchant_customer_id</code>.</td>
<td>Yes</td>
</tr>
<tr>
<td>onramp_user_email</td>
<td>String</td>
<td>The email the user has registered with ON/RAMP.</td>
<td>Yes</td>
</tr>
<tr>
<td>cancel_callback</td>
<td>Url</td>
<td>Merchant callback endpoint to be called when an egress payment couldn&#39;t be completed</td>
<td>No</td>
</tr>
<tr>
<td>accept_unregister_user</td>
<td>Bool</td>
<td>If <code>false</code> egress to users without an <strong>ON/RAMP</strong> account at the moment the egress was created will be immediately rejected. Defaults to <code>false</code></td>
<td>No</td>
</tr>
<tr>
<td>required_merchant_confirmation</td>
<td>Bool</td>
<td>If <code>true</code>, <strong>ON/RAMP</strong> will wait for a merchant confirmation before releasing the funds. Defaults to <code>true</code></td>
<td>No</td>
</tr>
</tbody></table>
<h3 id='egress-skin-2'>Egress Skin</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>title</td>
<td>String</td>
<td>Short string containing merchant&#39;s or redemption&#39;s name.</td>
<td>Yes</td>
</tr>
<tr>
<td>image</td>
<td>Url</td>
<td>image to stylize the offer.</td>
<td>Yes</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>A text explaining what the user is redeeming.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='billing-details-2'>Billing Details</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>payer_email</td>
<td>Email</td>
<td>Email of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_first_name</td>
<td>String</td>
<td>First name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_last_name</td>
<td>String</td>
<td>Last name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_phone</td>
<td>String</td>
<td>Including country code, without spaces or separators.</td>
<td>No</td>
</tr>
<tr>
<td>birth_date</td>
<td>Date</td>
<td>Date of birth of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>street</td>
<td>String</td>
<td>Street from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>unit</td>
<td>String</td>
<td>Unit from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>postal_code</td>
<td>String</td>
<td>Postal code from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>county</td>
<td>String</td>
<td>County from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>State from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>prefecture</td>
<td>String</td>
<td>Prefecture from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>Country from the billing address. Should be a 3 letter ISO Code.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_verified</td>
<td>Date</td>
<td>Date when the user was KYC verified.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_document</td>
<td>String</td>
<td>Type of the document. Some examples would be Passport or National_ID.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_reference</td>
<td>String</td>
<td>A unique id of the KYC verification. Something like a UUID.</td>
<td>No</td>
</tr>
<tr>
<td>address_verified</td>
<td>Date</td>
<td>Date when the address was verified.</td>
<td>No</td>
</tr>
<tr>
<td>address_doc_reference</td>
<td>String</td>
<td>A unique id of the address document reference.</td>
<td>No</td>
</tr>
<tr>
<td>player_level</td>
<td>String</td>
<td>Your internal player level. Something like New, Normal, VIP, ...</td>
<td>No</td>
</tr>
<tr>
<td>member_since</td>
<td>Date</td>
<td>The date since that user is a member of yours.</td>
<td>No</td>
</tr>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='response-json-fields-2'>Response JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>invoice_id</td>
<td>String</td>
<td>Internal <strong>ON/RAMP</strong>&#39;s Invoice Identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>Description about the invoice. Might be empty.</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td><strong>MIGHT NOT BE PRESENT</strong>: Additional status if user is not registered.</td>
</tr>
</tbody></table>

<p><strong>Note</strong>: If <code>accept_unregister_user</code> is set to <code>false</code> and user inputs a not registered email, <strong>ON/RAMP</strong> will respond with the attached response.</p>

<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"hint"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00001"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERR_CODE_UNKNOWN_USER_ACCOUNT"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>In that case, merchant should inform the user about email account being invalid and show a link to sign up with <strong>ON/RAMP</strong> at <a href="https://onrampwallet.com">https://onrampwallet.com</a>.</p>
<h1 id='payment-lifecycle-api'>Payment lifecycle API</h1><h2 id='mark-operation'>Mark Operation</h2>
<p>This call is for active (dis-)approval of payments by Merchant. See <a href="#api-flows">API flows</a>.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/mark_operation                           <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>  <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                    <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{ "op_id"  : "cde6f458-8754-4ffe-81a9-77c6d05a5540"
              , "accept" : true
              }'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cde6f458-8754-4ffe-81a9-77c6d05a5540"</span><span class="p">,</span><span class="w"> </span><span class="nl">"accept"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><h3 id='http-request'>HTTP Request</h3>
<aside class="success"><b><code> POST /rpc/mark_operation </code></b></aside>
<h3 id='request-json-fields'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>String</td>
<td>UUID reference that was returned from the <code>send_funds_to_email</code> endpoint.</td>
</tr>
<tr>
<td>accept</td>
<td>Boolean</td>
<td>Either if the merchant wants to approve (true) or reject (false) the process.</td>
</tr>
</tbody></table>
<h2 id='poll-operation-status'>Poll Operation status</h2>
<p>This endpoint can be used to query lifecycle status of payments by their UUID, to check
completion or query rejection reason.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/op_status <span class="se">\</span>
  <span class="nt">--header</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  <span class="nt">--header</span> <span class="s1">'X-XCO-Authorization: Bearer 00000000-0000-0000-0000-000000000000'</span> <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{"invoices_id": [
                 "eaed5195-b85c-41aa-9661-10693b65976e",
                 "0928b88d-372a-475e-8095-2f20a66cfa9f",
                 "5059dadc-4463-440b-9025-694355c0a941",
                 "73f4a88c-8591-4550-9b4d-dfa687d61a89",
                 "e59eeff7-5780-4707-b1f6-fa0a7e020ce0"]}'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"invoices_id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"eaed5195-b85c-41aa-9661-10693b65976e"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"0928b88d-372a-475e-8095-2f20a66cfa9f"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"5059dadc-4463-440b-9025-694355c0a941"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"73f4a88c-8591-4550-9b4d-dfa687d61a89"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"e59eeff7-5780-4707-b1f6-fa0a7e020ce0"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2f95c25e-389c-4b84-a78e-876f61069465"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"credit_card_payment_attempt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"accepted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"rejected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reject_reason"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nl">"when_submitted"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-03-17T11:41:00.000006+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_number_masked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"409849******1447"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_holder_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EXAMPLE REDACTED"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"67c39a53-cb5d-4e37-b56b-240fa93da416"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"waiting_user_confirmation"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"credit_card_payment_attempt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"accepted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"rejected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reject_reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"seon not ok with it"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"when_submitted"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-03-17T11:42:00.010659+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_number_masked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"498678******1000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_holder_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EXAMPLE REDACTED"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/op_status <span class="se">\</span>
  <span class="nt">--header</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  <span class="nt">--header</span> <span class="s1">'X-XCO-Authorization: Bearer 00000000-0000-0000-0000-000000000000'</span> <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{"invoices_id": [
                 "d3baca97-6edc-47cd-bc9f-67ae52863a01"]}'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"invoices_id"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"d3baca97-6edc-47cd-bc9f-67ae52863a01"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6ac514bc-7fbe-4c39-9309-1d83a6a46868"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"accepted"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"credit_card_payment_attempt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"accepted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"rejected"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reject_reason"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nl">"when_submitted"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-03-17T11:43:00.000006+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_number_masked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"498678******1000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_holder_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EXAMPLE REDACTED"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"74a9a709-c5cd-4e05-bcaa-853c37267e8c"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"waiting_user_confirmation"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"credit_card_payment_attempt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"accepted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"rejected"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"reject_reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Decline for CVV2 failure"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"when_submitted"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-03-17T11:41:00.010659+00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_number_masked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"498678******1000"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"card_holder_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EXAMPLE REDACTED"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><h3 id='http-request-2'>HTTP Request</h3>
<aside class="success"><b><code> POST /rpc/op_status </code></b></aside>
<h3 id='request-json'>Request JSON</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td><code>invoices_id</code></td>
<td>UUID[]</td>
<td>Array of payment UUID&#39;s to poll</td>
<td>yes</td>
</tr>
</tbody></table>
<h3 id='response-json'>Response JSON</h3>
<p>Response is an array of objects in unspecified order, each object describing one payment&#39;s
information. Invalid UUID&#39;s from request are silently skipped.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>op_id</code></td>
<td>UUID</td>
<td>Payment Operation reference from request</td>
</tr>
<tr>
<td><code>status</code></td>
<td>String</td>
<td>Operation status enum, see below</td>
</tr>
<tr>
<td><code>credit_card_payment_attempt</code></td>
<td>Object</td>
<td>Description of the associated CC payment</td>
</tr>
</tbody></table>

<p>The <code>status</code> field can assume the following values:</p>

<table><thead>
<tr>
<th>Enum value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>accepted</code></td>
<td>Operation is finished, CC funds transfer complete</td>
</tr>
<tr>
<td><code>rejected</code></td>
<td>Operation is finished, CC funds transfer not done</td>
</tr>
<tr>
<td><code>queued</code></td>
<td>Transitional state, ON/RAMP is about to invoke Merchant callback</td>
</tr>
<tr>
<td><code>waiting_merchant_confirmation</code></td>
<td>Awaiting delayed <a href="#mark-operation">approval callback</a> from Merchant</td>
</tr>
<tr>
<td><code>querying_merchant_for_confirmation</code></td>
<td>Merchant approval callback in progress, no response yet</td>
</tr>
<tr>
<td><code>waiting_user_confirmation</code></td>
<td>Awaiting User, who might be filling out CC data, passing KYC or deciding to press the final &quot;Confirm&quot;</td>
</tr>
</tbody></table>

<p>CC payment object fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>accepted</code></td>
<td>Bool</td>
<td><code>true</code> if CC funds transfer complete</td>
</tr>
<tr>
<td><code>rejected</code></td>
<td>Bool</td>
<td><code>true</code> if CC funds transfer cancelled</td>
</tr>
<tr>
<td><code>reject_reason</code></td>
<td>String</td>
<td><code>null</code> unless <code>rejected</code>, textual reason of rejection otherwise</td>
</tr>
<tr>
<td><code>when_submitted</code></td>
<td>Date</td>
<td>Timestamp of CC operation creation</td>
</tr>
<tr>
<td><code>card_number_masked</code></td>
<td>String</td>
<td>Masked CC number used in the payment</td>
</tr>
<tr>
<td><code>card_holder_name</code></td>
<td>String</td>
<td>Cardholder Name used in the payment</td>
</tr>
</tbody></table>
<h1 id='ingress-iframe-integration'>Ingress iframe integration</h1>
<p>This part of the docs provides a brief explananation and technical steps on how to integrate the ON/RAMP <strong>deposit iframe</strong> in any authorized merchant site.</p>

<p><strong>IMPORTANT</strong>: Before starting this integration, please let us know and we will add your domains to our code in order to trust them and allow the <code>window.postMessage</code> API communication between the iframe and your site work.</p>
<h2 id='adding-the-iframe-in-a-html-page'>Adding the iframe in a html page</h2>
<p>In order to display the deposit iframe it is as easy as adding the following code (displayed on the right side):</p>

<blockquote>
<p>Example iframe tag</p>
</blockquote>
<div class="highlight"><pre class="highlight html tab-html"><code><span class="nt">&lt;iframe</span>
    <span class="na">id=</span><span class="s">"onramp-iframe"</span>
    <span class="na">src=</span><span class="s">"https://onrampwallet.com/embedded-ingressing"</span>
    <span class="na">style=</span><span class="s">"width: 100%; min-width: 320px; min-height: 560px;"</span>
<span class="nt">&gt;&lt;/iframe&gt;</span>
</code></pre></div>
<p>As it can be seen, there are only three main attributes to deal with:</p>

<ul>
<li><p><code>id</code>: An id to later identify the iframe. The value can be anything you want as long as it is unique. On this docs we will asume it is:</p>

<ul>
<li>  &quot;onramp-iframe&quot;</li>
</ul></li>
<li><p><code>src</code>: The source of the iframe. There are two options to be used depending on the environment you are integrating with.</p>

<ul>
<li>  <strong>production</strong>: <a href="https://onrampwallet.com/embedded-ingressing">https://onrampwallet.com/embedded-ingressing</a></li>
<li>  <strong>stage</strong>: <a href="https://stage-wallet.onramp.ltd/embedded-ingressing">https://stage-wallet.onramp.ltd/embedded-ingressing</a></li>
</ul></li>
<li><p><code>style</code>: Styles to apply to the iframe. Here are the suggested values (This can be achieved by using a class too).</p>

<ul>
<li>  <code>width: 100%;</code>: This way the iframe occupies all available width from parent</li>
<li>  <code>min-width: 320px;</code>: Below this mininum width, the iframe wouldn&#39;t display its contents correctly.</li>
<li>  <code>min-height: 560px</code>: Although this one it is just recommended, having this minimum height will make scrollbars disappear.</li>
</ul></li>
</ul>
<h2 id='communicating-with-the-iframe-events'>Communicating with the iframe events</h2>
<p>The iframe contains both part of the implementation the merchant would have on their side as well as some implementation that usually happens on the wallet side.</p>

<p>Merchant would usually need to gather from the users what fiat amount and fiat currency they want to deposit and send it to the ON/RAMP api using the <code>create_ingress_invoice</code> endpoint to later redirect the users to the redirection url they got as a response from ON/RAMP. However, in this integration, the iframe will deal with gathering the information from the user and redirecting the user to the ON/RAMP wallet only if the payment was successful.</p>

<p>Given that, merchant host page and the iframe need a way to communicate certain events and this is achieve by using the <code>window.postMessage()</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">API</a>.</p>

<ul>
<li><p>Events sent from merchant:</p>

<ul>
<li>  <code>get_deposit_details</code></li>
<li>  <code>create_ingress_invoice</code></li>
</ul></li>
<li><p>Events sent from iframe:</p>

<ul>
<li>  <code>get_deposit_details</code></li>
<li>  <code>create_ingress_invoice</code></li>
</ul></li>
</ul>

<p>Both of the events are going to be initiated by the iframe and the merchant will respond to them.</p>
<h3 id='events'>Events</h3>
<ul>
<li>  <code>get_deposit_details</code> (response from merchant)</li>
</ul>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_currency</td>
<td>String</td>
<td>3 letter ISO code for the currency</td>
<td>No</td>
</tr>
<tr>
<td>fiat_amount</td>
<td>Integer</td>
<td>Amount to be preset</td>
<td>No</td>
</tr>
<tr>
<td>minFiatAmount</td>
<td>Integer</td>
<td>The minimum amount users will be able to deposit.</td>
<td>No</td>
</tr>
<tr>
<td>maxFiatAmount</td>
<td>Integer</td>
<td>The maximum amount users will be able to deposit.</td>
<td>No</td>
</tr>
<tr>
<td>showBillingDetails</td>
<td>Boolean</td>
<td>Flag to indicate if the inputs for billing details should be shown or not. If this is later directly provided in the <code>create_ingress_invoice</code> request, then here it is not needed.</td>
<td>No</td>
</tr>
<tr>
<td>allowInputAmount</td>
<td>Boolean</td>
<td>Flag to indicate if users should be able to change the requested amount.</td>
<td>No</td>
</tr>
</tbody></table>

<ul>
<li>  <code>create_ingress_invoice</code> (response from merchant)</li>
</ul>

<p>Here, just forward and return wathever the response from Onramp API is.</p>
<h3 id='example-of-integration'>Example of integration</h3>
<p>On the right side, there is a full example of an implementation any merchant could use in order to integrate our iframe.</p>

<p>Please, note the following:</p>

<ul>
<li><p>There are some functions that are not required and they have been added to show a complete integration that should just work. The only required implementation is the one about the <code>window.postMessage</code> and <code>window.addEventListener</code> APIs.</p></li>
<li><p>The example hardcode some values and that is marked with commments. In order to make this fully functional according tou your server and API, you will need to implement or adapt calls to store the deposits and make secure connections to the ON/RAMP API using your API key.</p></li>
</ul>

<blockquote>
<p>Example of integration</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">postMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">stringifiedMessage</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="nb">document</span>
        <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#onramp-iframe</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">stringifiedMessage</span><span class="p">,</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">createMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">event</span><span class="p">:</span> <span class="nx">eventName</span><span class="p">,</span>
        <span class="nx">data</span><span class="p">,</span>
        <span class="nx">error</span><span class="p">,</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">postData</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">url</span> <span class="o">=</span> <span class="dl">""</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// *GET, POST, PUT, DELETE, etc.</span>
            <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cors</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// no-cors, *cors, same-origin</span>
            <span class="na">cache</span><span class="p">:</span> <span class="dl">"</span><span class="s2">no-cache</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// *default, no-cache, reload, force-cache, only-if-cached</span>
            <span class="na">credentials</span><span class="p">:</span> <span class="dl">"</span><span class="s2">same-origin</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// include, *same-origin, omit</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
                <span class="c1">// 'Content-Type': 'application/x-www-form-urlencoded',</span>
            <span class="p">},</span>
            <span class="na">redirect</span><span class="p">:</span> <span class="dl">"</span><span class="s2">follow</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// manual, *follow, error</span>
            <span class="na">referrerPolicy</span><span class="p">:</span> <span class="dl">"</span><span class="s2">no-referrer</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url</span>
            <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="c1">// body data type must match "Content-Type" header</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span> <span class="c1">// parses JSON response into native JavaScript objects</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">getDepositDetails</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should get from your server what are the deposit details</span>
    <span class="c1">// For easiness on the docs we are going to have them hardcoded here</span>

    <span class="kd">const</span> <span class="nx">fiatCurrency</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">EUR</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">minFiatAmount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">maxFiatAmount</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">;</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">get_deposit_details</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">responseData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">fiatCurrency</span><span class="p">,</span>
        <span class="nx">minFiatAmount</span><span class="p">,</span>
        <span class="nx">maxFiatAmount</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">);</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">createIngressInvoice</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should send the provided data to your API</span>
    <span class="c1">// API should call the `create_ingress_invoice` endpoint on ON/RAMP API</span>
    <span class="c1">// Then the response should be sent back to the iframe</span>
    <span class="c1">// For easiness on the docs we are going to provide a standard implementation</span>

    <span class="kd">const</span> <span class="nx">serverURL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;YOUR_API_URL&gt;</span><span class="dl">"</span><span class="p">;</span>
    <span class="c1">// data contains `fiat_amount`</span>
    <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">postData</span><span class="p">(</span><span class="nx">serverURL</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">create_ingress_invoice</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">responseData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">invoiceId</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">invoice_id</span><span class="p">,</span>
        <span class="na">redirectionURL</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">redirection_url</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">);</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">trustedDomains</span> <span class="o">=</span> <span class="p">[</span>
        <span class="dl">"</span><span class="s2">https://stage-wallet.onramp.ltd</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">https://onrampwallet.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">];</span>
    <span class="kd">const</span> <span class="nx">defaultError</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">default_error</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="nx">trustedDomains</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">trustedDomain</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">trustedDomain</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">parsedMessage</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="nx">eventName</span> <span class="o">=</span> <span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">get_deposit_details</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">getDepositDetails</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">create_ingress_invoice</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">createIngressInvoice</span><span class="p">(</span><span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="nb">Error</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Default error</span><span class="dl">"</span> <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span>
                <span class="nx">eventName</span> <span class="o">||</span> <span class="nx">default_error</span><span class="p">,</span>
                <span class="kc">undefined</span><span class="p">,</span>
                <span class="nx">error</span>
            <span class="p">);</span>
            <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><h1 id='crypto-iframe-integration'>Crypto iframe integration</h1>
<p>This part of the docs provides a brief explananation and technical steps on how to integrate the ON/RAMP <strong>crypto iframe</strong> in any authorized merchant site.</p>

<p><strong>IMPORTANT</strong>: Before starting this integration, please let us know and we will add your domains to our code in order to trust them and allow the <code>window.postMessage</code> API communication between the iframe and your site work.</p>
<h2 id='adding-the-iframe-in-a-html-page'>Adding the iframe in a html page</h2>
<p>In order to display the crypto iframe it is as easy as adding the following code (displayed on the right side):</p>

<blockquote>
<p>Example iframe tag</p>
</blockquote>
<div class="highlight"><pre class="highlight html tab-html"><code><span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"crypto-iframe"</span> <span class="na">src=</span><span class="s">"https://crypto.onramp.ltd"</span> <span class="na">style=</span><span class="s">"width: 100%; min-width: 320px; min-height: 500px;"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</code></pre></div>
<p>As it can be seen, there are only three main attributes to deal with:</p>

<ul>
<li><p><code>id</code>: An id to later identify the iframe. The value can be anything you want as long as it is unique. On this docs we will asume it is:</p>

<ul>
<li>&quot;crypto-iframe&quot;</li>
</ul></li>
<li><p><code>src</code>: The source of the iframe. There are two options to be used depending on the environment you are integrating with.</p>

<ul>
<li><strong>production</strong>: <a href="https://crypto.onramp.ltd">https://crypto.onramp.ltd</a></li>
<li><strong>stage</strong>: <a href="https://crypto.stage-wallet.onramp.ltd">https://crypto.stage-wallet.onramp.ltd</a></li>
</ul></li>
<li><p><code>style</code>: Styles to apply to the iframe. Here are the suggested values (This can be achieved by using a class too).</p>

<ul>
<li><code>width: 100%;</code>: This way the iframe occupies all available width from parent</li>
<li><code>min-width: 320px;</code>: Below this mininum width, the iframe wouldn&#39;t display its contents correctly.</li>
<li><code>min-height: 500px</code>: Although this one it is just recommended, having this minimum height will make scrollbars disappear.</li>
</ul></li>
</ul>
<h2 id='communicating-with-the-iframe-events'>Communicating with the iframe events</h2>
<p>The iframe just contains the code to display the information for the whole process, but in order to actually make the communications with the ON/RAMP server it relies on the host page to forward those. This is mainly because all the calls need to be authenticated and for that we are going to use the merchants API key and that can&#39;t be exposed on the frontend.</p>

<p>Given that, merchant host page and the iframe need a way to communicate certain events and this is achieved by using the <code>window.postMessage()</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">API</a>.</p>

<p>There are several methods the iframe works with and so the merchant will have to deal with them too. Except the &quot;Crypto Ingress Configuration&quot;, in all the other ones, the merchant should just work as a proxy and forward and return the data. The urls to be hit are the same detailed <a href="/#on-ramp-merchant-integration">on the first section of this doc</a>.</p>
<h3 id='crypto-ingress-configuration'>Crypto Ingress Configuration</h3>
<p>Requests for the merchant to customize the appearance and some parameters of the iframe.</p>

<ul>
<li><p><code>crypto_ingress_config</code> (sent by the iframe)<br>
<em>No parameters</em>    </p></li>
<li><p><code>crypto_ingress_config_response</code> (returned by the merchant)</p></li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
<th>Default Value</th>
</tr>
</thead><tbody>
<tr>
<td>min_amount</td>
<td>Integer</td>
<td>Minimum fiat amount for the transaction.</td>
<td>No</td>
<td>10</td>
</tr>
<tr>
<td>max_amount</td>
<td>Integer</td>
<td>Maximum fiat amount for the transaction.</td>
<td>No</td>
<td>1000</td>
</tr>
<tr>
<td>fiat</td>
<td>String</td>
<td>ISO 3 digits fiat currency code.</td>
<td>No</td>
<td>EUR</td>
</tr>
<tr>
<td>user_info</td>
<td>User Info</td>
<td>A JSON object containing information about the user.</td>
<td>Yes</td>
<td>--</td>
</tr>
<tr>
<td>customization</td>
<td>Customization Info</td>
<td>A JSON object containing look and feel settings.</td>
<td>No</td>
<td>--</td>
</tr>
</tbody></table>

<p>User Info:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>

<p>Customization Info:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>primary_color</td>
<td>String</td>
<td>The main accent color that will be applied on UI elements.</td>
<td>No</td>
</tr>
<tr>
<td>font_color</td>
<td>String</td>
<td>The font color that will be applied on texts.</td>
<td>No</td>
</tr>
<tr>
<td>font_color_type</td>
<td>String</td>
<td>Either if UI is light or dark.</td>
<td>No</td>
</tr>
<tr>
<td>font_family</td>
<td>String</td>
<td>The font family name that will be applied in the whole UI.</td>
<td>No</td>
</tr>
<tr>
<td>background_color</td>
<td>String</td>
<td>The background color for the iframe.</td>
<td>No</td>
</tr>
</tbody></table>
<h3 id='crypto-ingress-status'>Crypto Ingress Status</h3>
<p>Requests for the iframe to know about the statuses of current open operations</p>

<ul>
<li><code>crypto_op_status</code> (sent by the iframe)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>

<ul>
<li><code>crypto_op_status_response</code> (sent by the merchant)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>JSON</td>
<td>Just the forwarded response from <code>/crypto_op_status</code> endpoint.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='crypto-ingress-address'>Crypto Ingress Address</h3>
<p>Requests for the iframe to ask for a crypto address to send the funds</p>

<ul>
<li><code>get_address</code> (sent by the iframe)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_amount</td>
<td>String</td>
<td>The amount of fiat to get.</td>
<td>Yes</td>
</tr>
<tr>
<td>fiat_currency</td>
<td>String</td>
<td>The currency of the fiat.</td>
<td>Yes</td>
</tr>
<tr>
<td>crypto_currency</td>
<td>String</td>
<td>The crypto currency to be used.</td>
<td>Yes</td>
</tr>
</tbody></table>

<ul>
<li><code>get_address_response</code> (sent by the merchant)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>JSON</td>
<td>Just the forwarded response from <code>/blockchain/api/v1/{chain}/address/new</code> endpoint.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='crypto-ingress-cancelation'>Crypto Ingress Cancelation</h3>
<p>Requests for the iframe to cancel an open operation</p>

<ul>
<li><code>crypto_op_cancel</code> (sent by the iframe)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>String</td>
<td>The UUID of the operation to cancel.</td>
<td>Yes</td>
</tr>
</tbody></table>

<ul>
<li><code>crypto_op_cancel_response</code> (sent by the merchant)</li>
</ul>

<p>Main Parameters:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>data</td>
<td>JSON</td>
<td>Just the forwarded response from <code>crypto_op_cancel</code> endpoint.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='example-of-integration'>Example of integration</h3>
<p>On the right side, there is a full example of an implementation any merchant could use in order to integrate our iframe.</p>

<p>Please, note the following: </p>

<ul>
<li><p>There are some functions that are not required and they have been added to show a complete integration that should just work. The only required implementation is the one about the <code>window.postMessage</code> and <code>window.addEventListener</code> APIs.</p></li>
<li><p>The example hardcodes some values and that is marked with commments. In order to make this fully functional according tou your server and API, you will need to implement or adapt calls to store the deposits and make secure connections to the ON/RAMP API using your API key.</p></li>
</ul>

<blockquote>
<p>Example of integration</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">postMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">stringifiedMessage</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#crypto-iframe</span><span class="dl">'</span><span class="p">).</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">stringifiedMessage</span><span class="p">,</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">createMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">event</span><span class="p">:</span> <span class="nx">eventName</span><span class="p">,</span>
        <span class="nx">data</span><span class="p">,</span>
        <span class="nx">error</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">postData</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">url</span> <span class="o">=</span> <span class="dl">''</span><span class="p">,</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// *GET, POST, PUT, DELETE, etc.</span>
            <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// no-cors, *cors, same-origin</span>
            <span class="na">cache</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cache</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// *default, no-cache, reload, force-cache, only-if-cached</span>
            <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">same-origin</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// include, *same-origin, omit</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
                <span class="c1">// 'Content-Type': 'application/x-www-form-urlencoded',</span>
            <span class="p">},</span>
            <span class="na">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">follow</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// manual, *follow, error</span>
            <span class="na">referrerPolicy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-referrer</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url</span>
            <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="c1">// body data type must match "Content-Type" header</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span><span class="c1">// parses JSON response into native JavaScript objects</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">error</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">getCryptoIngressConfig</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should get from your server what are the config details</span>
    <span class="c1">// For easiness on the docs we are going to have them hardcoded here</span>

    <span class="kd">const</span> <span class="nx">minAmount</span> <span class="o">=</span> <span class="mf">1.01</span>
    <span class="kd">const</span> <span class="nx">maxAmount</span> <span class="o">=</span> <span class="mi">5000</span>
    <span class="kd">const</span> <span class="nx">fiatCurrency</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">EUR</span><span class="dl">'</span>
    <span class="kd">const</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">merchant_customer_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">roger@coinweb.io</span><span class="dl">'</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">customization</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">primary_color</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rgb(80, 0, 151)</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">font_color</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#ffffff</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">font_color_type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dark</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">font_family</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Nunito, sans-serif</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">background_color</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rgb(23, 3, 47)</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">crypto_ingress_config_response</span><span class="dl">'</span>
    <span class="kd">let</span> <span class="nx">responseData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">min_amount</span><span class="p">:</span> <span class="nx">minAmount</span><span class="p">,</span>
        <span class="na">max_amount</span><span class="p">:</span> <span class="nx">maxAmount</span><span class="p">,</span>
        <span class="na">fiat</span><span class="p">:</span> <span class="nx">fiatCurrency</span><span class="p">,</span>
        <span class="na">user_info</span><span class="p">:</span> <span class="nx">userInfo</span><span class="p">,</span>
        <span class="na">customization</span><span class="p">:</span> <span class="nx">customization</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">responseData</span><span class="p">)</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">getCryptoOpStatus</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should send the provided data to your API</span>
    <span class="c1">// API should call the `crypto_op_status` endpoint on ON/RAMP API</span>
    <span class="c1">// Then the response should be sent back to the iframe</span>
    <span class="c1">// For easiness on the docs we are going to provide a standard implementation</span>

    <span class="kd">const</span> <span class="nx">serverURL</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;YOUR_API_URL&gt;</span><span class="dl">'</span>
    <span class="c1">// data contains a list of open operations</span>
    <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">postData</span><span class="p">(</span><span class="nx">serverURL</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">crypto_op_status_response</span><span class="dl">'</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">getAddress</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should send the provided data to your API</span>
    <span class="c1">// API should call the `blockchain/api/v1/{chain}/address/new` endpoint on ON/RAMP API</span>
    <span class="c1">// Then the response should be sent back to the iframe</span>
    <span class="c1">// For easiness on the docs we are going to provide a standard implementation</span>

    <span class="kd">const</span> <span class="nx">serverURL</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;YOUR_API_URL&gt;</span><span class="dl">'</span>
    <span class="c1">// data contains a new address to be funded</span>
    <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">postData</span><span class="p">(</span><span class="nx">serverURL</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get_address_response</span><span class="dl">'</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">getCryptoOpCancel</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Here you should send the provided data to your API</span>
    <span class="c1">// API should call the `crypto_op_cancel` endpoint on ON/RAMP API</span>
    <span class="c1">// Then the response should be sent back to the iframe</span>
    <span class="c1">// For easiness on the docs we are going to provide a standard implementation</span>

    <span class="kd">const</span> <span class="nx">serverURL</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;YOUR_API_URL&gt;</span><span class="dl">'</span>
    <span class="c1">// data contains success or failure to the cancel</span>
    <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">postData</span><span class="p">(</span><span class="nx">serverURL</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">crypto_op_cancel_response</span><span class="dl">'</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">trustedDomains</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">https://stage-wallet.onramp.ltd</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https://onrampwallet.com</span><span class="dl">'</span><span class="p">]</span>
    <span class="kd">const</span> <span class="nx">defaultError</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">default_error</span><span class="dl">'</span>
    <span class="kd">let</span> <span class="nx">eventName</span> <span class="o">=</span> <span class="kc">null</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">trustedDomains</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">trustedDomain</span> <span class="o">=&gt;</span> <span class="nx">trustedDomain</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">parsedMessage</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="nx">eventName</span> <span class="o">=</span> <span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">event</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">crypto_ingress_config</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">getCryptoIngressConfig</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">crypto_op_status</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">getCryptoOpStatus</span><span class="p">(</span><span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">get_address</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">getAddress</span><span class="p">(</span><span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">eventName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">crypto_op_cancel</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">await</span> <span class="nx">getCryptoOpCancel</span><span class="p">(</span><span class="nx">parsedMessage</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="nb">Error</span><span class="p">({</span><span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Default error</span><span class="dl">'</span><span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">eventName</span> <span class="o">||</span> <span class="nx">default_error</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
            <span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div><h1 id='crypto-ingress-flow'>Crypto Ingress Flow</h1>
<p>This documentation contains the main endpoints that participate in the Crypto Ingress Flow. Most of them are called directly from the <strong>iframe</strong>
integration that you can see <a href="#crypto-iframe-integration">here</a>.</p>

<p>From the User point of view, there are mainly 3 steps in the flow:</p>

<ol>
<li>User requests a new Crypto Address (<em>BTC or BCH</em>) to transfer coins into.</li>
<li>Once we verify that the user has transferred coins to that address, we notify back to the Merchant that there are new funds available from this user.</li>
<li>On this notification, the Merchant should request to initiate a new Invoice to transfer the Startpoints to them as in other Payments Methods.</li>
</ol>

<p>Steps <strong>2 and 3</strong> should be interactively between Merchant and ON/RAMP because of the nature of Blockchain transactions, since we need to wait to the user to transfer some coins but since the process is completely asynchronous and distributed, we dont know when the user is going to do the transfer and how much is going to transfer. </p>
<h2 id='user-request-a-crypto-address'>User request a Crypto Address</h2>
<p>As it is mentioned in <a href="#crypto-iframe-integration">Crypto Iframe Integration</a>, this is done by calling the endpoint in the <strong>iframe</strong> <code>get_address</code>. This is forwarding the call to the public endpoint:</p>

<aside class="success"><b><code>POST /blockchain/api/v1/{chain}/address/new</code></b></aside>

<blockquote>
<p>Example cURL </p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer MERCHANT_API_KEY"</span> <span class="nt">-d</span> <span class="s1">'{"merchant_customer_id": "123","fiat_amount": 10000, "fiat_currency": "EUR", "notify_new_funds_url": "http://mydomain.com/callback/notify/crypto_done" }'</span> http://localhost:7000/blockchain/api/v1/btc/address/new
</code></pre></div>
<blockquote>
<p>ReqAddress</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"merchant_customer_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"merchant_customer_id"</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"fiat_amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"fiat_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"notify_new_funds_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://mydomain.com/callback/notify/crypto_done"</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>AddressResponse</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ADDRESS_BASE58_OR_SPECIFIC_BLOCKCHAIN_ENCODING"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"chain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"btc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"qr_base64"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BASE_64_IMAGE_OF_ADDRESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>ErrorResponse (Status 400)</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"error_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR_ADDRESS_ALREADY_IN_USE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"in_use_addr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ADDRESS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"error_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR_MERCHANT_NOT_CONFIGURED_YET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"merchant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MERCHANT_API_KEY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>ErrorResponse (Status 401)</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"error_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR_MERCHANT_WRONG_API_KEY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MERCHANT_API_KEY"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>ErrorResponse (Status 500)</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"error_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR_CANNOT_CREATE_QR_CODE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some message"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"error_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR_UNKNOWN_ERROR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Some message"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='authentication'>Authentication</h3>
<table><thead>
<tr>
<th>type</th>
<th>Header Key</th>
<th>Header Value</th>
</tr>
</thead><tbody>
<tr>
<td>Header</td>
<td><code>x-xco-authorization</code></td>
<td><code>Bearer merchant_api_key</code></td>
</tr>
</tbody></table>
<h3 id='parameters'>Parameters</h3>
<table><thead>
<tr>
<th>name</th>
<th>type</th>
<th>values</th>
<th>description</th>
</tr>
</thead><tbody>
<tr>
<td>chain</td>
<td>enum</td>
<td><code>btc, bch</code></td>
<td>Blockchain the user requested ingress to</td>
</tr>
</tbody></table>
<h3 id='body'>Body</h3>
<table><thead>
<tr>
<th>Content Type</th>
<th>Data Type</th>
</tr>
</thead><tbody>
<tr>
<td><code>application/json</code></td>
<td><code>ReqAddress</code></td>
</tr>
</tbody></table>
<h3 id='responses'>Responses</h3>
<table><thead>
<tr>
<th>http code</th>
<th>content-type</th>
<th>response</th>
</tr>
</thead><tbody>
<tr>
<td><code>200</code></td>
<td><code>application/json</code></td>
<td><code>AddressResponse</code></td>
</tr>
<tr>
<td><code>400</code></td>
<td><code>application/json</code></td>
<td><code>ErrorResponse</code></td>
</tr>
<tr>
<td><code>401</code></td>
<td><code>application/json</code></td>
<td><code>ErrorResponse</code></td>
</tr>
<tr>
<td><code>500</code></td>
<td><code>application/json</code></td>
<td><code>ErrorResponse</code></td>
</tr>
</tbody></table>
<h2 id='on-ramp-notify-merchant-on-new-crypto-funds'>ON/RAMP notify Merchant on new Crypto Funds</h2>
<p>As we have seen in the previous endpoint the Merchant is going to provide some URL to notify back when there is some new funds from some user.</p>

<blockquote>
<p><strong><em>IMPORTANT</em></strong>: This is not the same as <code>payment_ack_url</code> because up to this point we don&#39;t know how much money the user is going to transfer and if in fact the user is going to transfer or not. This SHOULD NOT be consider as an INVOICE.</p>
</blockquote>

<p>When we are ready to do the callback notifying about new Crypto funds we are going to do the following call:</p>

<aside class="success"><b><code>POST `notify_new_funds_url`</code></b></aside>

<blockquote>
<p>Example cURL </p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer MERCHANT_API_KEY"</span> <span class="nt">-d</span> <span class="s1">'{"crypto_tx_ref": "123"}'</span> http://SOME_URL_SENT_IN_NOTIFY_NEW_FUNDS_URL
</code></pre></div>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> 
    </span><span class="nl">"crypto_tx_ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REFERENCE_ID_TO_BE_USED_IN_CALLING_CREATE_CRYPTO_INGRESS_INVOICE"</span><span class="p">,</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='authentication-2'>Authentication</h3>
<table><thead>
<tr>
<th>type</th>
<th>Header Key</th>
<th>Header Value</th>
</tr>
</thead><tbody>
<tr>
<td>Header</td>
<td><code>x-xco-authorization</code></td>
<td><code>Bearer merchant_api_key</code></td>
</tr>
</tbody></table>
<h3 id='responses-2'>Responses</h3>
<table><thead>
<tr>
<th>http code</th>
<th>content-type</th>
<th>response</th>
</tr>
</thead><tbody>
<tr>
<td><code>200</code></td>
<td><code>application/json</code></td>
<td>If Ok</td>
</tr>
<tr>
<td><code>500</code></td>
<td><code>application/json</code></td>
<td>If Error</td>
</tr>
</tbody></table>
<h2 id='merchant-create-new-crypto-invoice'>Merchant Create new Crypto Invoice</h2>
<p>Once the Merchant receives the notification on new crypto funds it should call the following endpoint to initiate the invoice and transfer of startpoints. Similar to <a href="#ingress-api">Ingress API</a>.</p>

<aside class="success"><b><code>POST `https://api.onramp.ltd/rpc/create_crypto_ingress_invoice`</code></b></aside>

<blockquote>
<p>Example cURL </p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://api.onramp.ltd/rpc/create_crypto_ingress_invoice           <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer MERCHANT_API_KEY"</span>                     <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                   <span class="se">\</span>
<span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{ "crypto_tx_ref"             : "RETURNED_BY_NOTIFICATION_ON_NEW_FUNDS"
              , "payment_ack_url"         : "wwww.example.com"
              , "timeout_in_sec"          : 3600
              , "billing_details"    :
                  { "payer_email"            : "mrpayer.payerson@email.com"
                  , "payer_first_name"       : "MrPayer"
                  , "payer_last_name"        : "Payerson"
                  , "payer_phone"            : "0034666444446"
                  , "birth_date"             : "1980-11-24 00:00:00.000000+00"
                  , "street"                 : "Main Street"
                  , "unit"                   : "Floor 7 12B"
                  , "postal_code"            : "0000001"
                  , "city"                   : "Big Town"
                  , "county"                 : "Big Town county"
                  , "state"                  : "CA"
                  , "prefecture"             : "Prefecture-ku"
                  , "country"                : "GBR"
                  , "kyc_verified"           : "2020-01-01 12:45:00.000000+00"
                  , "kyc_document"           : "Passport"
                  , "kyc_reference"          : "25177aa2-d848-846d-226c-97ec3096f5fe"
                  , "address_verified"       : "2020-01-01 12:55:00.000000+00"
                  , "address_doc_reference"  : "3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"
                  , "player_level"           : "New"
                  , "member_since"           : "2020-01-01 12:35:00.000000+00"
                  , "merchant_customer_id"   : "u2340112"
                  }
              }'</span>
</code></pre></div>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nl">"crypto_tx_ref"</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">"RETURNED_BY_NOTIFICATION_ON_NEW_FUNDS"</span><span class="w">
              </span><span class="p">,</span><span class="w"> </span><span class="nl">"payment_ack_url"</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="s2">"wwww.example.com"</span><span class="w">
              </span><span class="p">,</span><span class="w"> </span><span class="nl">"timeout_in_sec"</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="w">
              </span><span class="p">,</span><span class="w"> </span><span class="nl">"billing_details"</span><span class="w">    </span><span class="p">:</span><span class="w">
                  </span><span class="p">{</span><span class="w"> </span><span class="nl">"payer_email"</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="s2">"mrpayer.payerson@email.com"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"payer_first_name"</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">"MrPayer"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"payer_last_name"</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="s2">"Payerson"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"payer_phone"</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="s2">"0034666444446"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"birth_date"</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">"1980-11-24 00:00:00.000000+00"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"street"</span><span class="w">                 </span><span class="p">:</span><span class="w"> </span><span class="s2">"Main Street"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"unit"</span><span class="w">                   </span><span class="p">:</span><span class="w"> </span><span class="s2">"Floor 7 12B"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"postal_code"</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="s2">"0000001"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"city"</span><span class="w">                   </span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"county"</span><span class="w">                 </span><span class="p">:</span><span class="w"> </span><span class="s2">"Big Town county"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"state"</span><span class="w">                  </span><span class="p">:</span><span class="w"> </span><span class="s2">"CA"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"prefecture"</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="s2">"Prefecture-ku"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"country"</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"kyc_verified"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:45:00.000000+00"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"kyc_document"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"Passport"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"kyc_reference"</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">"25177aa2-d848-846d-226c-97ec3096f5fe"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"address_verified"</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:55:00.000000+00"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"address_doc_reference"</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="s2">"3sdffdss-4mgo-44gfd-34dx-r34rfdfs4gf"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"player_level"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"member_since"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01 12:35:00.000000+00"</span><span class="w">
                  </span><span class="p">,</span><span class="w"> </span><span class="nl">"merchant_customer_id"</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="s2">"u2340112"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
              </span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='authentication-3'>Authentication</h3>
<table><thead>
<tr>
<th>type</th>
<th>Header Key</th>
<th>Header Value</th>
</tr>
</thead><tbody>
<tr>
<td>Header</td>
<td><code>x-xco-authorization</code></td>
<td><code>Bearer merchant_api_key</code></td>
</tr>
</tbody></table>

<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"invoice_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"62b570e8-9723-4287-a5a8-e825c2ffced2"</span><span class="w">
</span><span class="p">,</span><span class="w"> </span><span class="nl">"invoice_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://wallet.onramp.ltd/ingressing?reference=a3076265-138d-4be6-89fb-d50427adaf4e"</span><span class="w">
</span><span class="p">,</span><span class="w"> </span><span class="nl">"invoice_url_qr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.onramp.ltd/qr_encode/68747470733a2f2f73746167652d77616c6c65742e6f6e72616d702e6c74642f656772657373696e673f7265666572656e63653d38303061343437382d393832322d343561382d616239302d323637306665393262343933"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='request-json-fields'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>crypto_tx_ref</td>
<td>String</td>
<td>Reference returned by the <code>notify_new_funds_url</code> callback.</td>
<td>Yes</td>
</tr>
<tr>
<td>payment_ack_url</td>
<td>Url</td>
<td>Merchant callback endpoint to confirm ingress transaction. It should be a complete, well formed, url.</td>
<td>Yes</td>
</tr>
<tr>
<td>timeout_in_sec</td>
<td>Integer</td>
<td>When to expire the link if unused.</td>
<td>Yes</td>
</tr>
<tr>
<td>billing_details</td>
<td>Billing Details</td>
<td>User billing details. Please, notice how <strong>not</strong> all parameters inside this json object are required except <code>merchant_customer_id</code>.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h3 id='billing-details'>Billing Details</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th> Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>payer_email</td>
<td>Email</td>
<td>Email of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_first_name</td>
<td>String</td>
<td>First name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_last_name</td>
<td>String</td>
<td>Last name of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>payer_phone</td>
<td>String</td>
<td>Including country code, without spaces or separators.</td>
<td>No</td>
</tr>
<tr>
<td>birth_date</td>
<td>Date</td>
<td>Date of birth of the user making the payment.</td>
<td>No</td>
</tr>
<tr>
<td>street</td>
<td>String</td>
<td>Street from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>unit</td>
<td>String</td>
<td>Unit from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>postal_code</td>
<td>String</td>
<td>Postal code from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>county</td>
<td>String</td>
<td>County from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>state</td>
<td>String</td>
<td>State from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>prefecture</td>
<td>String</td>
<td>Prefecture from the billing address.</td>
<td>No</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>Country from the billing address. Should be a 3 letter ISO Code.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_verified</td>
<td>Date</td>
<td>Date when the user was KYC verified.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_document</td>
<td>String</td>
<td>Type of the document. Some examples would be Passport or National_ID.</td>
<td>No</td>
</tr>
<tr>
<td>kyc_reference</td>
<td>String</td>
<td>A unique id of the KYC verification. Something like a UUID.</td>
<td>No</td>
</tr>
<tr>
<td>address_verified</td>
<td>Date</td>
<td>Date when the address was verified.</td>
<td>No</td>
</tr>
<tr>
<td>address_doc_reference</td>
<td>String</td>
<td>A unique id of the address document reference.</td>
<td>No</td>
</tr>
<tr>
<td>player_level</td>
<td>String</td>
<td>Your internal player level. Something like New, Normal, VIP, ...</td>
<td>No</td>
</tr>
<tr>
<td>member_since</td>
<td>Date</td>
<td>The date since that user is a member of yours.</td>
<td>No</td>
</tr>
<tr>
<td>merchant_customer_id</td>
<td>String</td>
<td>The merchant customer id.</td>
<td>Yes</td>
</tr>
</tbody></table>
<h1 id='server-to-server-s2s'>Server to Server (S2S)</h1><h2 id='steps'>Steps</h2>
<ol>
<li>Merchant makes a request to <code>create_operation</code> endpoint.</li>
<li>Merchant gets <code>op_id</code> in the response and stores it for further usage if needed.</li>
<li>At that moment, we start calling <code>callback_url</code> with the different possible status.</li>
<li>When merchant receives <code>WAITING_USER_TO_BE_REDIRECTED</code>, they redirect the user to the 3DS url.</li>
<li>The user is redirected first to a url of our server in order for us to update the status of the operation and then it gets to the actual 3DS page.</li>
<li>User completes 3DS (with success or fail) and gets redirected to our webhook.</li>
<li>Our webhook updates the operation and redirects the user to the url provided on <code>user_redirect_url</code>.</li>
<li>After that we continue calling <code>callback_url</code> whenever we have an update on the status. Alternatively, merchant could call operation_status.</li>
<li>Once the merchant receives either <code>ACCEPTED</code> or <code>REJECTED</code>, the process finishes.</li>
</ol>
<h2 id='authentication'>Authentication</h2>
<blockquote>
<p>Header Based</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer &lt;API_KEY&gt;"</span><span class="w">
</span></code></pre></div>
<p>Each API Key is associated to a specific MID.</p>

<p>Operations created under a specific API key will only be visible with the same API key.</p>
<h2 id='status-definition'>Status definition</h2>
<p>Here is the list of all the existing status and their definition.</p>

<ul>
<li>  <code>PENDING</code>:
Operation has only been created and it is waiting for a response to get a 3DS url or an error.</li>
<li>  <code>WAITING_USER_TO_BE_REDIRECTED</code>:
3DS url has been created and user should be redirected to that.</li>
<li>  <code>USER_REDIRECTED</code>:
User has been redirected to the 3DS page.</li>
<li>  <code>PROCESSING_USER_PAYMENT</code>:
User has completed 3DS and the payment is being processed.</li>
<li>  <code>ACCEPTED</code>:
The payment has been accepted.</li>
<li>  <code>REJECTED</code>:
The payment has been rejected by the bank.</li>
<li>  <code>CANCELLED</code>:
Operation has been cancelled.</li>
</ul>

<p>Diagram for visual explanation of the flow:</p>

<p><img src="images/s2s_flow-accb897f.png" alt="" /></p>
<h2 id='callbacks'>Callbacks</h2>
<p>Whenever there&#39;s a change on a operation status, a status-change callback will be triggered.</p>

<p>Status-change callbacks will be retried with exponential decay until they get correctly answered.</p>

<p>It will be a POST to the callback_url with the following payload in json format:</p>

<p><strong>WARNING</strong>: in rare cases, it might be possible for status-change callbacks to be duplicated or received out of order, therefore we recommend to check the <code>date</code> field to detect this anomalities.</p>
<h3 id='http-callback-request'>HTTP Callback Request</h3>
<aside class="success"><b><code> POST callback_url</code></b></aside>

<p><code>callback_url</code>: URL sent as value in <code>create_operation</code> endpoint</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://CALLBACK_URL                                    <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{
        "op_id": "c6cce9a4-af6d-4572-a0ab-d7bc2ad159ba",
            "status": {
                "waiting_user_to_be_redirected": {
                    "url": "https://api.onramp.ltd/rpc/deposit"
                }
            },
            "date": 1626971748
        }'</span>
</code></pre></div>
<blockquote>
<p>Request Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6cce9a4-af6d-4572-a0ab-d7bc2ad159ba"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"waiting_user_to_be_redirected"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.onramp.ltd/rpc/deposit"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1626971748</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='request-callback-json-fields'>Request Callback JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>To which operation this status change refers to</td>
<td>uuid</td>
</tr>
<tr>
<td>status</td>
<td>The new status the operation is currently at</td>
<td>Status</td>
</tr>
<tr>
<td>date</td>
<td>Timestamp of the creation of the new status</td>
<td>timestamp</td>
</tr>
</tbody></table>
<h3 id='status-field'>Status Field</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>pending</td>
<td>initial state</td>
<td>Object</td>
</tr>
<tr>
<td>waiting_user_to_be_redirected</td>
<td>Merchant shall redirect the user to the given url.</td>
<td>RedirectObj</td>
</tr>
<tr>
<td>user_redirected</td>
<td>Waiting user to complete 3DS step.</td>
<td>Object</td>
</tr>
<tr>
<td>processing_user_payment</td>
<td>Waiting acquirer answer.</td>
<td>Object</td>
</tr>
<tr>
<td>accepted</td>
<td>Operation completed. Final state</td>
<td>Object</td>
</tr>
<tr>
<td>rejected</td>
<td>Operation was cancel on aquarier side. Final state</td>
<td>ErrorObj</td>
</tr>
<tr>
<td>cancelled</td>
<td>Operation was cancel on our side. Final state</td>
<td>CancelObj</td>
</tr>
</tbody></table>
<h3 id='redirectobj'>RedirectObj</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>url</td>
<td>where to redirect the user to.</td>
<td>url</td>
</tr>
</tbody></table>
<h3 id='errorobj'>ErrorObj</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>error_code</td>
<td>original specific aquarier error identifier.</td>
<td>string</td>
</tr>
<tr>
<td>error_reason</td>
<td>Enum of common error reasons.</td>
<td>ErrorType</td>
</tr>
</tbody></table>
<h3 id='errortype'>ErrorType</h3>
<ul>
<li><code>&#39;ISSUER_OFFLINE&#39;</code>.</li>
<li><code>&#39;UNSUPPORTED_CARD_COUNTRY&#39;</code>.</li>
<li><code>&#39;INSUFICIENT_FUNDS&#39;</code>.</li>
<li><code>&#39;UNSUPPORTED_CARD_TYPE&#39;</code>.</li>
<li><code>&#39;UNSUPPORTED_CURRENCY&#39;</code>.</li>
<li><code>&#39;INVALID_CARDNUMBER&#39;</code>.</li>
<li><code>&#39;CVV2_FAILURE&#39;</code>.</li>
<li><code>&#39;UNSPECIFIED_CC_ERR&#39;</code>.</li>
</ul>
<h3 id='cancelobj'>CancelObj</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>reason</td>
<td>Description of the merchant or user action after which the operation was cancel.</td>
<td>string</td>
</tr>
</tbody></table>
<h3 id='merchant-response'>Merchant Response</h3><h3 id='http-status-200'>HTTP Status 200</h3><h3 id='response-json-fields'>Response Json Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>ID of the operation to be updated</td>
<td>uuid</td>
</tr>
<tr>
<td>action</td>
<td>Action to be performed</td>
<td>Action</td>
</tr>
</tbody></table>
<h3 id='action'>Action</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>request_attempt_cancel</td>
<td>We&#39;ll try to cancel the operation, but it should not assumed it will happen.</td>
<td>object</td>
</tr>
<tr>
<td>continue</td>
<td>Merchant acknowledges it has received the callback.</td>
<td>object</td>
</tr>
</tbody></table>

<blockquote>
<p>Response Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"request_attempt_cancel"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><em>Note: If an unknown status is sent, merchant should respond with <code>continue</code></em></p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"continue"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='card-fields'>Card fields</h3>
<p>This table defines all the potential required fields for credit card as well as some required only sometimes. To see which one applies to your MID, check the <code>credit_card_fields</code> endpoint.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
<th>Always Required</th>
</tr>
</thead><tbody>
<tr>
<td>card_number</td>
<td>Valid card number</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>card_expiry_month</td>
<td>The expiry month on the credit card. With the format of MM.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>card_expiry_year</td>
<td>The expiry year on the credit card. With the format of YY.</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>card_cvv</td>
<td>The CVV value for the card</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>card_holder_first_name</td>
<td>The card first holder name as it appears on the card</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>card_holder_last_name</td>
<td>The card last holder name as it appears on the card</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>email</td>
<td>Email of the user making the payment</td>
<td>string</td>
<td>true</td>
</tr>
<tr>
<td>street</td>
<td>Street of the user&#39;s billing address</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>city</td>
<td>City of the user&#39;s billing address</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>postal_code</td>
<td>Postal code of the user&#39;s billing address</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>state</td>
<td>State of the user&#39;s billing address</td>
<td>string</td>
<td>false</td>
</tr>
<tr>
<td>country</td>
<td>Country of the user&#39;s billing address. It should be <a href="https://www.iso.org/iso-3166-country-codes.html">ISO 3166 complaint</a></td>
<td>string</td>
<td>false</td>
</tr>
</tbody></table>
<h2 id='get-credit-card-fields'>Get credit card fields</h2>
<aside class="success"><b><code>GET /rpc/credit_card_fields</code></b></aside>

<p>Get the list of required credit-card fields for the current API Key. Notice different API keys might required a different set of fields to be provided.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://BASE_URL/rpc/credit_card_fields                                    <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
</code></pre></div><h3 id='http-request'>HTTP Request</h3>
<ul>
<li>No Body</li>
</ul>
<h3 id='http-response'>HTTP Response</h3>
<ul>
<li>Status 200</li>
</ul>
<h3 id='http-response-fields'>HTTP Response Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>fields</td>
<td>List of available credit card fields</td>
<td>CreditCardField -&gt; FieldDescrtiption</td>
</tr>
</tbody></table>
<h3 id='creditcardfield'>CreditCardField</h3>
<p>One of:</p>

<ul>
<li>  <code>&#39;credit_card_number&#39;</code></li>
<li>  <code>&#39;credit_card_name&#39;</code></li>
<li>  ... see previous <a href="#card-fields"><em>Card fields</em></a> section.</li>
</ul>

<p><a href="#card-fields">See credit card fields section</a></p>
<h3 id='fielddescription'>FieldDescription</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>description</td>
<td>Description about the field</td>
<td>string</td>
</tr>
<tr>
<td>regex</td>
<td>Regular expression to validate the field</td>
<td>string</td>
</tr>
<tr>
<td>optional</td>
<td>Boolean flag to know if the field is optional</td>
<td>boolean</td>
</tr>
<tr>
<td>examples</td>
<td>List of example values</td>
<td>array</td>
</tr>
</tbody></table>

<blockquote>
<p>Request Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"credit_card_number"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The credit card number"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35d{3})d{11})$"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"examples"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"4242424242424242"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3700 0000 0000 002"</span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"credit_card_expiry_month"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The month when the credit card expires"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0[1-9]|1[0-2]$"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"examples"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"01"</span><span class="p">,</span><span class="w"> </span><span class="s2">"12"</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id='create-operation'>Create Operation</h2>
<aside class="success"><b><code> POST /rpc/create_operation</code></b></aside>

<p>This endpoint is meant to be used to start a payment once all the user the details for the operation has been gathered from the user (amount, currency, credit card details, ...).</p>

<p><strong>*To be noted</strong>: if you receive a specific error about incorrect credit card details (code <code>ERR_CODE_INVALID_CARD_DETAILS</code>), please first make a call to <code>credit_card_fields</code> to get the new valid ones and repeat the operaiton with those.*</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://BASE_URL/rpc/create_operation                                    <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{
    "fiat_amount": "1000",
    "fiat_currency": "EUR",
    "callback_url": "https://api.betway.com/deposit-webhook",
    "user_redirect_url": "https://betway.api/user/deposits",
    "card_details": {
        "card_number": "4242424242424242",
        "card_expiry_month": "12",
        "card_expiry_year": "21",
        "card_cvv": "356"
    }
}'</span>
</code></pre></div><h3 id='http-request-fields'>HTTP Request Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>fiat_amount</td>
<td>Integer between a min value and a max value, in cents.</td>
<td>string</td>
</tr>
<tr>
<td>fiat_currency</td>
<td>ISO 4127 currency 3 digits code. https://www.iso.org/iso-4217-currency-codes.html</td>
<td>string</td>
</tr>
<tr>
<td>callback_url</td>
<td>URL to be called by us to inform about updates on the operation status.</td>
<td>string</td>
</tr>
<tr>
<td>user_redirect_url</td>
<td>URL to use to redirect the user after 3DS on the operation status.</td>
<td>string</td>
</tr>
<tr>
<td>card_details</td>
<td>Object of credit card details</td>
<td>Credit-Card-Field</td>
</tr>
</tbody></table>

<blockquote>
<p>Request Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"fiat_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fiat_currency"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"callback_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.betway.com/deposit-webhook"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"user_redirect_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://betway.api/user/deposits"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"card_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"card_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4242424242424242"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"card_expiry_month"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"card_expiry_year"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"card_cvv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"356"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='http-response-2'>HTTP Response</h3>
<ul>
<li>Status 200</li>
</ul>
<h3 id='http-response-fields-2'>HTTP Response Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>ID of the operation to be used as a reference.</td>
<td>Array[uuid][1]</td>
</tr>
</tbody></table>

<blockquote>
<p>Response Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[{</span><span class="w"> </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7ffb7577-e4f9-4980-89d0-a1936f9088f4"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span></code></pre></div><h2 id='operation-status'>Operation status</h2>
<aside class="success"><b><code>GET /rpc/operation_status?op_id={op_id}</code></b></aside>

<p>This endpoint can be used both to know about the status of an operation or as an alternative to callbacks. At any moment, if you would like to know about the status of an operation, you can make a request here to know about it.</p>

<p>It returns the list of status-changes related to the given event.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://BASE_URL/rpc/operation_status?op_id<span class="o">=</span>7ffb7577-e4f9-4980-89d0-a1936f9088f4     <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
<span class="o">}</span><span class="s1">'
</span></code></pre></div><h3 id='http-request-fields-2'>HTTP Request Fields</h3>
<ul>
<li>No body</li>
</ul>
<h3 id='http-response-3'>HTTP Response</h3>
<ul>
<li>Status 200</li>
</ul>
<h3 id='http-response-fields-3'>HTTP Response Fields</h3>
<ul>
<li><a href="#callbacks">See callback status section</a></li>
</ul>
<h2 id='update-operation'>Update Operation</h2>
<aside class="success"><b><code> POST /rpc/update_operation</code></b></aside>

<p>Send an action to a given operation, this action will be executed as if it were responsed on a status-change event callback.</p>

<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://BASE_URL/rpc/update_operation                                    <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"x-xco-authorization: Bearer 00000000-0000-0000-0000-000000000000"</span>                   <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>                                                     <span class="se">\</span>
    <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s1">'{
    "op_id": "5b99dfb2-ef07-4fb7-9d20-62d63ce0f737",
    "action": {
        "request_attempt_cancel": {}
    }
}'</span>
</code></pre></div><h3 id='http-request-fields-3'>HTTP Request Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead><tbody>
<tr>
<td>op_id</td>
<td>ID of the operation to be updated.</td>
<td>uuid</td>
</tr>
<tr>
<td>action</td>
<td>Action to be performed. Please see, <a href="https://hackmd.io/m7zCvFtkSNGdrsKNYcTu4A#Callbacks">callbacks section</a></td>
<td>Action</td>
</tr>
</tbody></table>

<blockquote>
<p>Request Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"op_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5b99dfb2-ef07-4fb7-9d20-62d63ce0f737"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"request_attempt_cancel"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='http-response-4'>HTTP Response</h3>
<ul>
<li>Status 200</li>
</ul>
<h3 id='http-response-5'>HTTP Response</h3>
<ul>
<li>Empty Json</li>
</ul>

<blockquote>
<p>Response Json Example</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{}</span><span class="w">
</span></code></pre></div><h2 id='testing'>Testing</h2><h3 id='unstable-environment-testing'>Unstable environment testing:</h3>
<p>While testing on this environment set <code>CVV</code> to:</p>

<ul>
<li><p><code>001</code> to immediate accept the CC payment.</p></li>
<li><p><code>002</code> for 3DS.</p></li>
<li><p><code>003</code> to immediate reject the CC payment.</p></li>
</ul>
<h2 id='api-changes-amp-backward-compatibility'>API changes &amp; backward compatibility:</h2>
<p>To keep flexibility for future new features, while not loosing backward compatibility, merchants using this API are requested to:</p>

<ul>
<li><p>Assume that any Json could contain extra fields not specified on this document.</p></li>
<li><p>Not to assume that objects with an unespecified contain will be either empty or not.</p></li>
<li><p>Be able to answer unkown types of status change callbacks by answering <code>continue</code>.</p></li>
</ul>
<h1 id='quotes-api'>Quotes API</h1>
<p>In case you are getting crypto in return of an <a href="/#ingress-api">ingress</a>, you can get the reference prices for it if you would like to display that to users at the beginning of the process.</p>
<h2 id='base-url'>Base URL</h2>
<p>Production and Test:
<strong><a href="https://api.blockfort-exchange.io">https://api.blockfort-exchange.io</a></strong></p>
<h2 id='get-reference-prices'>Get reference prices</h2>
<blockquote>
<p>Example Call</p>
</blockquote>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> GET <span class="se">\</span>
    <span class="s1">'https://api.blockfort-exchange.io/referenceTrade'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'x-api-key: QU0J2HfUMH0r2Yh3I3EhRyK4qRx30likZ7dBRsP8'</span> <span class="se">\</span>
    <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
    <span class="nt">-d</span> <span class="s1">'{
            "currency_lhs":"gbp",
            "currency_rhs":"usdt",
            "amount_lhs":100,
            "direction":"sell"
        }'</span>
</code></pre></div>
<blockquote>
<p>Request JSON Body</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"currency_lhs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gbp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currency_rhs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usdt"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_lhs"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="nl">"direction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sell"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>Response JSON</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"currency_lhs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gbp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"currency_rhs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"usdt"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_lhs"</span><span class="p">:</span><span class="w"> </span><span class="mi">-100</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount_rhs"</span><span class="p">:</span><span class="w"> </span><span class="mf">134.37825813749998</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exchange_rate"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.343782581375</span><span class="p">,</span><span class="w">
    </span><span class="nl">"timestamp_utc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-09-03T04:16:14"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id='http-request'>HTTP Request</h3>
<aside class="success"><b><code> GET /referenceTrade </code></b></aside>
<h3 id='request-json-fields'>Request JSON Fields</h3>
<table><thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead><tbody>
<tr>
<td>currency_lhs</td>
<td>String</td>
<td>Left hand side currency.</td>
<td>Yes</td>
</tr>
<tr>
<td>currency_rhs</td>
<td>String</td>
<td>Right hand side currency.</td>
<td>Yes</td>
</tr>
<tr>
<td>amount_lhs</td>
<td>Integer</td>
<td>Amount to buy (if positive) or sell (if negative) of the left hand side currency. Sign will be ignored if the &quot;direction&quot; parameter is sent.</td>
<td>Yes</td>
</tr>
<tr>
<td>direction</td>
<td>String</td>
<td>Optional parameter that indicates if the results are going to be about buying or selling the left hand side currency.</td>
<td>No</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
          </div>
      </div>
    </div>
  </body>
</html>
